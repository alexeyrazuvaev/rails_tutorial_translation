<div id="top"></div>


<h1 class="chapter"><a id="sec-5" href="filling-in-the-layout#top" class="heading"><span class="number">Глава 5</span> Заполнение шаблона</a></h1>


<p>В процессе краткого обзора Ruby в <a class="ref" href="rails-flavored-ruby#top">Главе&nbsp;4</a> мы узнали о подключении таблиц стилей к примеру приложения, но, как было отмечено в <a class="ref" href="rails-flavored-ruby#sec-css_revisited">Разделе&nbsp;4.3.4</a>, эти таблицы стилей в настоящий момент пусты. В этой главе мы это изменим, включив фреймворк <em>Bootstrap</em> в наше приложение и добавив затем немного своих стилей.<sup class="footnote" id="fnref-5_1"><a href="#fn-5_1">1</a></sup> Мы также начнем заполнять шаблон ссылками на страницы (например Home и About), которые мы создали ранее (<a class="ref" href="filling-in-the-layout#sec-structure">Раздел&nbsp;5.1</a>). В процессе мы узнаем о частичных шаблонах (partials), Rails маршрутах и файлопроводе, включая небольшое введение в Sass (<a class="ref" href="filling-in-the-layout#sec-sass_and_the_asset_pipeline">Раздел&nbsp;5.2</a>). Мы также отрефакторим тесты из <a class="ref" href="static-pages#top">Главы&nbsp;3</a> используя последние веяния RSpec. Мы закончим, сделав первый важный шаг на пути создания опции регистрации пользователей на нашем сайте.</p>

<div class="label" id="sec-structure"></div>


<h2><a id="sec-5_1" href="filling-in-the-layout#sec-structure" class="heading"><span class="number">5.1</span> Добавление некоторых структур</a></h2>


<p><em>Rails Учебник</em> это книга по веб-разработке, а не по веб-дизайну, но  работа над приложением, которое выглядит как <em>полное</em> дерьмо - удручает, поэтому, в этом разделе мы добавим некоторые структуры в шаблон и придадим ему минимальный дизайн с CSS. В дополнение к нашим собственным CSS правилам, мы будем использовать <a href="http://twitter.github.com/bootstrap/">Bootstrap</a> - CSS фреймворк с открытым исходным кодом от Twitter. Мы также придадим нашему <em>коду</em> немного стиля, так сказать, используя <em>частичные шаблоны</em> почистим шаблон, поскольку он немного загроможден.</p>

<p>При создании веб-приложений, часто бывает полезным получить  общий вид пользовательского интерфейса как можно раньше. Таким образом, на протяжении остальной части книги, я буду часто использовать <em>макеты</em> (в контексте Веб часто называемыми <em>каркасами</em>), которые являются грубыми набросками того, как приложение, возможно, будет выглядеть.<sup class="footnote" id="fnref-5_2"><a href="#fn-5_2">2</a></sup> В этой главе мы будем главным образом разрабатывать статические страницы введеные в <a class="ref" href="static-pages#sec-static_pages">Разделе&nbsp;3.1</a>, включая логотип сайта, заголовок с навигацией по сайту, и подвал сайта. Каркас для наиболее важной из страниц&nbsp;&mdash;&nbsp;Home страницы, представлен на <a class="ref" href="filling-in-the-layout#fig-home_page_mockup">Рис.&nbsp;5.1</a>. Вы можете увидеть конечный результат на <a class="ref" href="filling-in-the-layout#fig-site_with_footer">Рис.&nbsp;5.7</a>. Он отличается в некоторых деталях, но это нормально, так как каркас и не должен быть абсолютно точным.</p>

<div class="label" id="fig-home_page_mockup"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/home_page_mockup_bootstrap.png" alt="home_page_mockup_bootstrap" /></span></div><div class="caption"><span class="header">Рис. 5.1: </span><span class="description">Каркас Home страницы примера приложения.&nbsp;<a href="http://railstutorial.org/images/figures/home_page_mockup_bootstrap-full.png">(полный размер)</a></span></div></div>


<p>Как обычно, если вы используете Git для управления версиями, то сейчас самое время создать новую ветку:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git checkout -b filling-in-layout
</pre></div>
</div>


<div class="label" id="sec-adding_to_the_layout"></div>


<h3><a id="sec-5_1_1" href="filling-in-the-layout#sec-adding_to_the_layout" class="heading"><span class="number">5.1.1</span> Навигация по сайту</a></h3>


<p>В качестве первого шага к добавлению ссылок и стилей к примеру приложения, мы добавим в файл шаблона сайта <code>application.html.erb</code> (последний раз мы его видели в <a class="ref" href="rails-flavored-ruby#code-application_layout_full_title">Листинге&nbsp;4.3</a>) дополнительные HTML структуры. Это подразумевает добавление нескольких дополнительных разделителей, немного CSS классов и запуск навигации по сайту. Полный файл представлен в <a class="ref" href="filling-in-the-layout#code-layout_new_structure">Листинге&nbsp;5.1</a>; объяснения различных частей последуют сразу за ним. Если вы не хотите откладывать удовольствие, вы можете посмотреть на результаты представленные на <a class="ref" href="filling-in-the-layout#fig-layout_no_logo_or_custom_css">Рис.&nbsp;5.2</a>. (<em>Примечание:</em> это (пока) не очень приятно.)</p>

<div class="label" id="code-layout_new_structure"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.1.</span> <span class="description">Шаблон сайта с добавленными структурами. <br /> <code>app/views/layouts/application.html.erb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span><span class="cp">&lt;%=</span> <span class="n">full_title</span><span class="p">(</span><span class="k">yield</span><span class="p">(</span><span class="ss">:title</span><span class="p">))</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span>    <span class="s2">&quot;application&quot;</span><span class="p">,</span> <span class="ss">media:</span> <span class="s2">&quot;all&quot;</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s2">&quot;application&quot;</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">csrf_meta_tags</span> <span class="cp">%&gt;</span>
    <span class="c">&lt;!--[if lt IE 9]&gt;</span>
<span class="c">    &lt;script src=&quot;http://html5shim.googlecode.com/svn/trunk/html5.js&quot;&gt;&lt;/script&gt;</span>
<span class="c">    &lt;![endif]--&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;header</span> <span class="na">class=</span><span class="s">&quot;navbar navbar-fixed-top navbar-inverse&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar-inner&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
          <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;sample app&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="s2">&quot;logo&quot;</span> <span class="cp">%&gt;</span>
          <span class="nt">&lt;nav&gt;</span>
            <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;nav pull-right&quot;</span><span class="nt">&gt;</span>
              <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Home&quot;</span><span class="p">,</span>    <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
              <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Help&quot;</span><span class="p">,</span>    <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
              <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Sign in&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
            <span class="nt">&lt;/ul&gt;</span>
          <span class="nt">&lt;/nav&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/header&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p>Первое что стоит отметить это переход от старого Ruby&nbsp;1.8&ndash;стиля хэшей к новому, Ruby&nbsp;1.9 - стилю (<a class="ref" href="rails-flavored-ruby#sec-hashes_and_symbols">Раздел&nbsp;4.3.3</a>). Здесь,</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span> <span class="s2">&quot;application&quot;</span><span class="p">,</span> <span class="ss">:media</span> <span class="o">=&gt;</span> <span class="s2">&quot;all&quot;</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>было заменено на</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span> <span class="s2">&quot;application&quot;</span><span class="p">,</span> <span class="ss">media:</span> <span class="s2">&quot;all&quot;</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>Важно понимать что старый синтаксис хэшей имеет глубокие корни и вы должны уметь распознавать оба варианта.</p>

<p>Давайте просмотрим другие новые элементы <a class="ref" href="filling-in-the-layout#code-layout_new_structure">Листинга&nbsp;5.1</a>. Как вкратце отмечалось в <a class="ref" href="static-pages#sec-static_pages">Разделе&nbsp;3.1</a>, Rails&nbsp;3 по умолчанию использует HTML5 (о чем говорит doctype <code>&lt;!DOCTYPE html&gt;</code>); т.к. HTML5&nbsp;&mdash;&nbsp;новый стандарт и некоторые браузеры (особенно старые версии Internet Explorer) пока не полностью его поддерживают, мы включим JavaScript код (известный как &ldquo;<a href="http://code.google.com/p/html5shim/">HTML5 shim</a>&rdquo;) чтобы обойти это затруднение:</p>

<div class="code"><div class="highlight"><pre><span class="c">&lt;!--[if lt IE 9]&gt;</span>
<span class="c">&lt;script src=&quot;http://html5shim.googlecode.com/svn/trunk/html5.js&quot;&gt;&lt;/script&gt;</span>
<span class="c">&lt;![endif]--&gt;</span>
</pre></div>
</div>


<p>Немного странный синтаксис</p>

<div class="code"><div class="highlight"><pre><span class="c">&lt;!--[if lt IE 9]&gt;</span>
</pre></div>
</div>


<p>включает закомментированную строку, только если версия Microsoft Internet Explorer&nbsp;(IE) ниже чем&nbsp;9 (<code>if lt IE 9</code>). Чудной <code>[if lt IE 9]</code> синтаксис <em>не</em> является частью Rails; это <a   href="http://ru.wikipedia.org/wiki/Условные_комментарии">условный комментарий</a> поддерживаемый браузерами Internet Explorer специально для подобных ситуаций. Это хорошая вещь, хотя бы потому, что это означает, что мы можем включить дополнительную таблицу стилей <em>только</em> для IE браузеров  версии менее 9, не затрагивая такие браузеры как Firefox, Chrome и Safari.</p>

<p>Следующий раздел включает <code>header</code> для (текстового) логотипа сайта, несколько разделителей (использующих <code>div</code> тег) и список элементов с навигационными ссылками:</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;header</span> <span class="na">class=</span><span class="s">&quot;navbar navbar-fixed-top navbar-inverse&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar-inner&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;sample app&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="s2">&quot;logo&quot;</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;nav&gt;</span>
        <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;nav pull-right&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Home&quot;</span><span class="p">,</span>    <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Help&quot;</span><span class="p">,</span>    <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Sign in&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
      <span class="nt">&lt;/nav&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/header&gt;</span>
</pre></div>
</div>


<p>Здесь тег <code>header</code> обозначает элементы которые должны находиться вверху страницы. Мы добавили тегу <code>header</code> три <em>CSS класса</em>,<sup class="footnote" id="fnref-5_3"><a href="#fn-5_3">3</a></sup> - <code>navbar</code>, <code>navbar-inverse</code> и <code>navbar-fixed-top</code>, разделенных пробелом:</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;header</span> <span class="na">class=</span><span class="s">&quot;navbar navbar-fixed-top navbar-inverse&quot;</span><span class="nt">&gt;</span>
</pre></div>
</div>


<p>Всем HTML элементам могут быть назначены как классы, так и <em>id</em> (идентификаторы); это всего лишь ярлыки и они используются для стилевания сайта с помощью CSS (<a class="ref" href="filling-in-the-layout#sec-custom_css">Раздел&nbsp;5.1.2</a>). Основное различие между классами и идентификаторами, в том, что классы могут быть использованы несколько раз на странице, а идентификаторы могут быть использованы лишь один раз. В данном случае, и <code>navbar</code> и <code>navbar-fixed-top</code> классы имеют особое значение для фреймворка Bootstrap, который мы установим и начнем использовать в <a class="ref" href="filling-in-the-layout#sec-custom_css">Разделе&nbsp;5.1.2</a>.</p>

<p>Внутри тега <code>header</code> мы видим несколько <code>div</code> тегов:</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar-inner&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
</pre></div>
</div>



<p>Тег <code>div</code> это разделитель; он не делает ничего, кроме разделения документа на отдельные части. В старом стиле HTML, <code>div</code> теги использовали почти для всех разделов сайта, но HTML5 добавил <code>header</code>, <code>nav</code> и <code>section</code> элементы для разделов, общих для многих приложений. В данном случае каждый <code>div</code> снабжен CSS классом. Как и в случае с тегом <code>header</code>, эти классы имеют особое значение для Bootstrap.</p>

<p>После дивов мы неожиданно наталкиваемся на встроенный Ruby:</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;sample app&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="s2">&quot;logo&quot;</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;nav&gt;</span>
  <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;nav pull-right&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Home&quot;</span><span class="p">,</span>    <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Help&quot;</span><span class="p">,</span>    <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Sign in&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/nav&gt;</span>
</pre></div>
</div>


<p>Этот список использует Rails хелпер <code>link_to</code> для создания ссылок (которые мы создавали непосредственно с якорным (анкорным) тегом&nbsp;<code>a</code> в <a class="ref" href="static-pages#sec-passing_title_tests">Разделе&nbsp;3.3.2</a>); первый аргумент в <code>link_to</code> это текст ссылки, а второй это URI. Мы заменим URI на <em>именованные маршруты</em> в <a class="ref" href="filling-in-the-layout#sec-named_routes">Разделе&nbsp;5.3.3</a>, но сейчас мы используем заглушки URI <code>&rsquo;#&rsquo;</code> обычно применяемые  в веб-дизайне. Третий аргумент это хэш опций, в данном случае добавление  CSS&nbsp;id <code>logo</code> для ссылки на пример приложения. (У остальных трех ссылок хэш опций отсутствует, и это нормально поскольку это необязательный аргумент.) Rails хелперы часто принимают хэш опций подобным образом, что дает нам возможность добавлять произвольные HTML опции оставаясь в рамках Rails.</p>

<p>Второй элемент внутри дивов это список навигационных ссылок, созданный с помощью тега <em>ненумерованного списка</em> <code>ul</code>, совместно с тегом <em>элемента списка</em> <code>li</code>:</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;nav&gt;</span>
  <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;nav pull-right&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Home&quot;</span><span class="p">,</span>    <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Help&quot;</span><span class="p">,</span>    <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Sign in&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/nav&gt;</span>
</pre></div>
</div>

<p>Тег <code>nav</code>, хотя формально здесь и не нужен, служит для обозначения того что это именно навигационные ссылки. Классы <code>nav</code> и <code>pull-right</code> тега <code>ul</code> имеют особое значение для Bootstrap. После того как Rails обработает этот шаблон и оценит встроенный Ruby, список будет выглядеть следующим образом:</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;nav&gt;</span>
  <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;nav pull-right&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span><span class="nt">&gt;</span>Home<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span><span class="nt">&gt;</span>Help<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span><span class="nt">&gt;</span>Sign in<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/nav&gt;</span>
</pre></div>
</div>


<p>Завершающая часть шаблона это <code>div</code> для основного контента:</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
  <span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>


<p>Как и прежде, класс <code>container</code> имеет специальное значение для Bootstrap. Как мы узнали в <a class="ref" href="static-pages#sec-layouts">Разделе&nbsp;3.3.4</a>, метод <code>yield</code> вставляет содержимое каждой страницы в шаблон сайта.</p>

<p>Если не брать в расчет подвал сайта, который мы добавим в <a class="ref" href="filling-in-the-layout#sec-partials">Разделе&nbsp;5.1.3</a>, наш шаблон теперь завершен, и мы можем посмотреть на результаты, посетив, например, Home страницу. Для того чтобы извлечь пользу из ожидающих своего часа элементов стиля, мы добавим несколько дополнительных элементов к <code>home.html.erb</code> представлению (<a class="ref" href="filling-in-the-layout#code-signup_button">Листинг&nbsp;5.2</a>).</p>

<div class="label" id="code-signup_button"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.2.</span> <span class="description">Home страница со ссылкой на страницу регистрации. <br /> <code>app/views/static_pages/home.html.erb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;center hero-unit&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;h1&gt;</span>Welcome to the Sample App<span class="nt">&lt;/h1&gt;</span>

  <span class="nt">&lt;h2&gt;</span>
    This is the home page for the
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
    sample application.
  <span class="nt">&lt;/h2&gt;</span>

  <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Sign up now!&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="ss">class:</span> <span class="s2">&quot;btn btn-large btn-primary&quot;</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">image_tag</span><span class="p">(</span><span class="s2">&quot;rails.png&quot;</span><span class="p">,</span> <span class="ss">alt:</span> <span class="s2">&quot;Rails&quot;</span><span class="p">),</span> <span class="s1">&#39;http://rubyonrails.org/&#39;</span> <span class="cp">%&gt;</span>
</pre></div>
</div></div>


<p>В ожидании добавления пользователей к нашему сайту в <a class="ref" href="sign-up#top">Главе&nbsp;7</a>, первый <code>link_to</code> создает ссылку-заглушку вида</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span> <span class="na">class=</span><span class="s">&quot;btn btn-large btn-primary&quot;</span><span class="nt">&gt;</span>Sign up now!<span class="nt">&lt;/a&gt;</span>
</pre></div>
</div>


<p>В теге <code>div</code> CSS класс <code>hero-unit</code> предназначен для Bootstrap, также как и <code>btn</code>, <code>btn-large</code> и <code>btn-primary</code> классы в кнопке signup.</p>

<p>Второй <code>link_to</code> показывает нам <code>image_tag</code> хелпер, который принимает в качестве аргумента путь к изображению и необязательный хэш опций, в данном случае, <code>alt</code> атрибут тега image с помощью символа. Чтобы внести некоторую ясность, давайте взглянем на HTML производимый этим тегом:<sup class="footnote" id="fnref-5_4"><a href="#fn-5_4">4</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;img</span> <span class="na">alt=</span><span class="s">&quot;Rails&quot;</span> <span class="na">src=</span><span class="s">&quot;/assets/rails.png&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>


<p><code>Alt</code> атрибут, это то, что будет отображаться, если нет изображения, также его используют читатели экрана для слабовидящих. Хотя люди иногда пренебрежительно относятся к включению атрибута <code>alt</code> для изображений, на самом деле его включенин требуется HTML стандартом. К счастью, Rails включает дефолтный атрибут <code>alt</code>; если вы не укажете его явно при вызове <code>image_tag</code>, Rails пропишет в него название файла изображения (за вычетом расширения). В данном случае мы все же явно установили <code>alt</code> текст для того чтобы капитализировать &ldquo;Rails&rdquo;.</p>

<p>Теперь мы, наконец, готовы увидеть плоды наших трудов (<a class="ref" href="filling-in-the-layout#fig-layout_no_logo_or_custom_css">Рис.&nbsp;5.2</a>). Говорите "Не впечатляет"? Может быть. К счастью, однако, мы проделали хорошую работу, прописав для наших HTML элементов внятные классы и идентификаторы, которые позволят нам отстилить наш сайт с помощью CSS.</p>

<p>Кстати, вы возможно были удивлены, обнаружив что изображение  <code>rails.png</code> уже существует. Откуда оно взялось? Оно бесплатно включено в каждое новое Rails приложение и вы найдете его в <code>app/assets/images/rails.png</code>. Поскольку мы используем хелпер <code>image_tag</code>, Rails находит его автоматически с помощью файлопровода (<a class="ref" href="filling-in-the-layout#sec-sass_and_the_asset_pipeline">Раздел&nbsp;5.2</a>).</p>

<div class="label" id="fig-layout_no_logo_or_custom_css"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/layout_no_logo_or_custom_css_bootstrap.png" alt="layout_no_logo_or_custom_css_bootstrap" /></span></div><div class="caption"><span class="header">Рис. 5.2: </span><span class="description">Страница Home (<a href="http://localhost:3000/static_pages/home"><tt>/static_pages/home</tt></a>) без кастомного CSS.&nbsp;<a href="http://railstutorial.org/images/figures/layout_no_logo_or_custom_css_bootstrap-full.png">(полный размер)</a></span></div></div>




<div class="label" id="sec-custom_css"></div>


<h3><a id="sec-5_1_2" href="filling-in-the-layout#sec-custom_css" class="heading"><span class="number">5.1.2</span> Bootstrap и кастомные CSS</a></h3>


<p>В <a class="ref" href="filling-in-the-layout#sec-adding_to_the_layout">Разделе&nbsp;5.1.1</a> мы связали многие HTML элементы с CSS классами, которые дают нам большую гибкость при построении шаблона с помощью CSS. Как отмечалось в <a class="ref" href="filling-in-the-layout#sec-adding_to_the_layout">Разделе&nbsp;5.1.1</a>, многие из этих классов специфичны для <a href="http://twitter.github.com/bootstrap/">Bootstrap</a> - фреймворка от Twitter который делает легким создание приятного веб дизайна и элементов пользовательского интерфейса для HTML5 приложений. В этом разделе мы будем комбинировать Bootstrap с небольшим количеством кастомных CSS правил для того чтобы придать некоторый стиль примеру приложения.</p>

<p>Нашим первым шагом будет добавление Bootstrap, что может быть сделано в Rails приложениях с помощью <tt>bootstrap-sass</tt> гема, как это показано в <a class="ref" href="filling-in-the-layout#code-bootstrap_sass">Листинге&nbsp;5.3</a>. Фреймворк Bootstrap изначально использует язык <a href="http://lesscss.org/">LESS CSS</a> для создания динамических таблиц стилей, но файлопровод в Rails по умолчанию поддерживает (очень похожий) язык Sass (<a class="ref" href="filling-in-the-layout#sec-sass_and_the_asset_pipeline">Раздел&nbsp;5.2</a>), <tt>bootstrap-sass</tt> конвертирует LESS в Sass и делает все необходимые файлы Bootstrap доступными для текущего приложения.<sup class="footnote" id="fnref-5_5"><a href="#fn-5_5">5</a></sup></p>

<div class="label" id="code-bootstrap_sass"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.3.</span> <span class="description">Добавление гема <tt>bootstrap-sass</tt> в <code>Gemfile</code>.</span>
</div>
<div class="code"><div class="highlight"><pre><span class="n">source</span> <span class="s1">&#39;https://rubygems.org&#39;</span>

<span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.2.13&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;bootstrap-sass&#39;</span><span class="p">,</span> <span class="s1">&#39;2.1&#39;</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>
</pre></div>
</div></div>



<p>Для установки Bootstrap мы, как обычно запускаем <code>bundle install</code>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle install
</pre></div>
</div>


<p>Затем рестартуем веб-сервер для того чтобы изменения вступили в силу. (На большинстве систем рестарт сервера подразумевает нажатие <tt>Ctrl-C</tt> и последующий запуск <code>rails server</code>.)</p>

<p>Первый шаг в добавлении кастомных CSS к нашему приложению это создание файла для их хранения:</p>

<div class="code"><div class="highlight"><pre><span class="go">app/assets/stylesheets/custom.css.scss</span>
</pre></div>
</div>


<p>(Используйте ваш текстовый редактор или IDE для создания нового файла.) В данном случае важными являются и название директории и название файла. Директория</p>

<div class="code"><div class="highlight"><pre><span class="go">app/assets/stylesheets</span>
</pre></div>
</div>


<p>это часть файлопровода (<a class="ref" href="filling-in-the-layout#sec-sass_and_the_asset_pipeline">Раздел&nbsp;5.2</a>) и любые таблицы стилей в этой директории будут автоматически включены как часть файла <code>application.css</code> включенного в шаблон сайта. Кроме того, название файла <code>custom.css.scss</code> включает расширение <code>.css</code>, которое обозначает файл CSS, и расширение <code>.scss</code> которое указывает на то что это &ldquo;Sassy CSS&rdquo; файл и говорит файлопроводу что этот файл необходимо обрабатывать с помошью Sass. (Мы не будем использовать Sass до <a class="ref" href="filling-in-the-layout#sec-sass">Раздела&nbsp;5.2.2</a>, но сейчас он необходим <tt>bootstrap-sass</tt> гему.)</p>

<p>После создания файла для кастомных CSS мы можем использовать функцию <code>@import</code> для включения Bootstrap, как это показано в <a class="ref" href="filling-in-the-layout#code-bootstrap_css">Листинге&nbsp;5.4</a>.</p>

<div class="label" id="code-bootstrap_css"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.4.</span> <span class="description">Добавление Bootstrap CSS. <br /> <code>app/assets/stylesheets/custom.css.scss</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">@import</span> <span class="s2">&quot;bootstrap&quot;</span><span class="p">;</span>
</pre></div>
</div></div>


<p>Эта единственная строка включает весь Bootstrap CSS фреймворк, результат показан на <a class="ref" href="filling-in-the-layout#fig-sample_app_only_bootstrap">Рис.&nbsp;5.3</a>. (Вам, возможно, придется рестартовать веб сервер. Стоит также отметить что скриншоты используют Bootstrap&nbsp;2.0, в то время как учебник использует Bootstrap&nbsp;2.1, так что могут быть небольшие отличия во внешнем виде, но это не повод для беспокойства.)  Текст расположен плохо и логотип оказался неотстиленым, но цвета и кнопка регистрации выглядят многообещающе.</p>

<div class="label" id="fig-sample_app_only_bootstrap"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/sample_app_only_bootstrap.png" alt="sample_app_only_bootstrap" /></span></div><div class="caption"><span class="header">Рис. 5.3: </span><span class="description">Пример приложения с Bootstrap CSS.&nbsp;<a href="http://railstutorial.org/images/figures/sample_app_only_bootstrap-full.png">(полный размер)</a></span></div></div>


<p>Затем мы добавим немного CSS который будет использован для стилизации шаблона и каждой отдельной страницы, как это показано в <a class="ref" href="filling-in-the-layout#code-universal_css">Листинге&nbsp;5.5</a>. В <a class="ref" href="filling-in-the-layout#code-universal_css">Листинге&nbsp;5.5</a> довольно много правил; для того чтобы понять что делает  CSS правило, часто бывает полезным закомментировать его с помощью CSS комментариев, т.e., поместив его внутрь <code>/* &hellip; */</code> и посмотреть что изменилось.
Результат CSS из <a class="ref" href="filling-in-the-layout#code-universal_css">Листинга&nbsp;5.5</a> показан на <a class="ref" href="filling-in-the-layout#fig-sample_app_universal">Рис.&nbsp;5.4</a>.</p>

<div class="label" id="code-universal_css"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.5.</span> <span class="description">Добавление CSS для придания некого универсального стиля применяемого ко всем страницам. <br /> <code>app/assets/stylesheets/custom.css.scss</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">@import</span> <span class="s2">&quot;bootstrap&quot;</span><span class="p">;</span>

<span class="cm">/* universal */</span>

<span class="nt">html</span> <span class="p">{</span>
  <span class="na">overflow-y</span><span class="o">:</span> <span class="no">scroll</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">body</span> <span class="p">{</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">60</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">section</span> <span class="p">{</span>
  <span class="na">overflow</span><span class="o">:</span> <span class="no">auto</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">textarea</span> <span class="p">{</span>
  <span class="na">resize</span><span class="o">:</span> <span class="n">vertical</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.center</span> <span class="p">{</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.center</span> <span class="nt">h1</span> <span class="p">{</span>
  <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div></div>




<div class="label" id="fig-sample_app_universal"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/sample_app_universal.png" alt="sample_app_universal" /></span></div><div class="caption"><span class="header">Рис. 5.4: </span><span class="description">Добавление нескольких отступов и прочих универсальных стилей.&nbsp;<a href="http://railstutorial.org/images/figures/sample_app_universal-full.png">(полный размер)</a></span></div></div>


<p>Обратите внимание что CSS в <a class="ref" href="filling-in-the-layout#code-universal_css">Листинге&nbsp;5.5</a> имеют последовательный вид. В целом, CSS правила относятся либо к классу, id, HTML тегу или к какой либо их комбинации за которыми идет список стилевых команд. Например,</p>

<div class="code"><div class="highlight"><pre><span class="nt">body</span> <span class="p">{</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">60</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>


<p>задает отступ в 60&nbsp;пикселей от верхнего края страницы. Благодаря классу <code>navbar-fixed-top</code> в теге <code>header</code>, Bootstrap фиксирует панель навигации вверху страницы, таким образом отступ служит для разделения основного текста и навигации. (Поскольку дефолтный цвет навигационной панели в Boostrap 2.1 отличается от того что ранее использовался в версии 2.0, нам пришлось добавить класс <code>navbar-inverse</code> для того чтобы сделать его черным вместо (теперь) дефолтного белого.) Между тем, CSS в правиле</p>

<div class="code"><div class="highlight"><pre><span class="nc">.center</span> <span class="p">{</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>


<p>связывает класс <code>center</code> со свойством <code>text-align: center</code>. Другими словами, точка <code>.</code> в <code>.center</code> указывает на то, что правило стилизует класс. (Как мы увидим в <a class="ref" href="filling-in-the-layout#code-logo_css">Листинге&nbsp;5.7</a>, знак фунта <code>#</code> указывает на правило для стилизации CSS <em>id</em>.) Это означает что этот элемент внутри любого тега (такого как <code>div</code>) с классом <code>center</code> будет отцентрован на странице. (Мы увидим пример этого класса в <a class="ref" href="filling-in-the-layout#code-signup_button">Листинге&nbsp;5.2</a>.)</p>

<p>Хотя Bootstrap поставляется с CSS правилами для приятной типографики, мы также добавим немного кастомных правил для представления текста на нашем сайте, как это показано в <a class="ref" href="filling-in-the-layout#code-typography_css">Листинге&nbsp;5.6</a>. (Не все эти правила применяются к странице Home page, но каждое правило будет использовано в какой-то части примера приложения.) Результат <a class="ref" href="filling-in-the-layout#code-typography_css">Листинга&nbsp;5.6</a> показан на <a class="ref" href="filling-in-the-layout#fig-sample_app_typography">Рис.&nbsp;5.5</a>.</p>

<div class="label" id="code-typography_css"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.6.</span> <span class="description">Добавление CSS для хорошей типографики. <br /> <code>app/assets/stylesheets/custom.css.scss</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">@import</span> <span class="s2">&quot;bootstrap&quot;</span><span class="p">;</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>

<span class="o">/*</span> <span class="nt">typography</span> <span class="o">*/</span>

<span class="nt">h1</span><span class="o">,</span> <span class="nt">h2</span><span class="o">,</span> <span class="nt">h3</span><span class="o">,</span> <span class="nt">h4</span><span class="o">,</span> <span class="nt">h5</span><span class="o">,</span> <span class="nt">h6</span> <span class="p">{</span>
  <span class="na">line-height</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">h1</span> <span class="p">{</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">3</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-2</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">30</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">h2</span> <span class="p">{</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.7</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-1</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">30</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
  <span class="na">font-weight</span><span class="o">:</span> <span class="no">normal</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#999</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">p</span> <span class="p">{</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.1</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">line-height</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.7</span><span class="kt">em</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div></div>




<div class="label" id="fig-sample_app_typography"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/sample_app_typography.png" alt="sample_app_typography" /></span></div><div class="caption"><span class="header">Рис. 5.5: </span><span class="description">Добавление нескольких стилей для типографики.&nbsp;<a href="http://railstutorial.org/images/figures/sample_app_typography-full.png">(полный размер)</a></span></div></div>


<p>Наконец, мы добавим несколько правил для придания стиля логотипу сайта, который представляет собой текст &ldquo;sample app&rdquo;. CSS в <a class="ref" href="filling-in-the-layout#code-logo_css">Листинге&nbsp;5.7</a> конвертирует текст в верхний регистр и изменяет его размер, цвет и положение. (Мы использовали CSS&nbsp;id потому что предполагаем что логотип сайта будет на странице в единственном экземпляре, но вы можете использовать класс вместо него.)</p>

<div class="label" id="code-logo_css"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинге 5.7.</span> <span class="description">Добавление CSS для логотипа сайта. <br /> <code>app/assets/stylesheets/custom.css.scss</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">@import</span> <span class="s2">&quot;bootstrap&quot;</span><span class="p">;</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>

<span class="o">/*</span> <span class="nt">header</span> <span class="o">*/</span>

<span class="nn">#logo</span> <span class="p">{</span>
  <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
  <span class="na">margin-right</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.7</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#fff</span><span class="p">;</span>
  <span class="na">text-transform</span><span class="o">:</span> <span class="no">uppercase</span><span class="p">;</span>
  <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-1</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">9</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">font-weight</span><span class="o">:</span> <span class="no">bold</span><span class="p">;</span>
  <span class="na">line-height</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="nn">#logo</span><span class="nd">:hover</span> <span class="p">{</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#fff</span><span class="p">;</span>
  <span class="na">text-decoration</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div></div>


<p>Здесь <code>color: #fff</code> изменяет цвет логотипа на белый. HTML цвета могут быть закодированы шестью base-16 (шестнадцатеричными) числами, по одному для каждого из основных цветов красного, зеленого и голубого (именно в этом порядке). Код <code>#ffffff</code> максимизирует все три цвета, приводя к чистому белому и <code>#fff</code> это сокращение для <code>#ffffff</code>. CSS стандарт также определяет большое количество синонимов для часто употребляемых <a href="http://www.w3schools.com/html/html_colornames.asp">HTML цветов</a>, включая <code>white</code> для <code>#fff</code>. Результат CSS из <a class="ref" href="filling-in-the-layout#code-logo_css">Листинга&nbsp;5.7</a> показан на <a class="ref" href="filling-in-the-layout#fig-sample_app_logo">Рис.&nbsp;5.6</a>.</p>

<div class="label" id="fig-sample_app_logo"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/sample_app_logo.png" alt="sample_app_logo" /></span></div><div class="caption"><span class="header">Рис. 5.6: </span><span class="description">Пример приложения с приятно отстиленным логотипом.&nbsp;<a href="http://railstutorial.org/images/figures/sample_app_logo-full.png">(полный размер)</a></span></div></div>




<div class="label" id="sec-partials"></div>


<h3><a id="sec-5_1_3" href="filling-in-the-layout#sec-partials" class="heading"><span class="number">5.1.3</span> Частичные шаблоны (partials)</a></h3>


<p>Хотя шаблон в <a class="ref" href="filling-in-the-layout#code-layout_new_structure">Листинге&nbsp;5.1</a> и выполняет свою работу, но он становится немного суматошным. HTML shim занимает три строки и использует странный IE-специфичный синтаксис, и было бы хорошо вынести его в какое нибудь отдельное место. К тому же заголовок формирует отдельную логическую единицу и он весь должен быть упакован в одном месте. Мы можем достигнуть этого, используя удобное Rails-приспособление называемое <em>partials</em> (# партиалы, частичные шаблоны). Давайте сначала посмотрим, как шаблон выглядит после определения партиалов (<a class="ref" href="filling-in-the-layout#code-layout_with_partials">Листинг&nbsp;5.8</a>).</p>

<div class="label" id="code-layout_with_partials"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.8.</span> <span class="description">Шаблон сайта с партиалами для таблицы стилей и header-а. <br /> <code>app/views/layouts/application.html.erb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span><span class="cp">&lt;%=</span> <span class="n">full_title</span><span class="p">(</span><span class="k">yield</span><span class="p">(</span><span class="ss">:title</span><span class="p">))</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span>    <span class="s2">&quot;application&quot;</span><span class="p">,</span> <span class="ss">media:</span> <span class="s2">&quot;all&quot;</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s2">&quot;application&quot;</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">csrf_meta_tags</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">&#39;layouts/shim&#39;</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">&#39;layouts/header&#39;</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p>В <a class="ref" href="filling-in-the-layout#code-layout_with_partials">Листинге&nbsp;5.8</a> мы заменили HTML shim строки одним вызовом Rails помощника называемого <code>render</code>:</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">&#39;layouts/shim&#39;</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>Эта строка приводит к поиску файла, называемого  <code>app/views/layouts/_shim.html.erb</code>, оценке его содержимого и вставке результата оценки в представление.<sup class="footnote" id="fnref-5_6"><a href="#fn-5_6">6</a></sup> (Напомним, что <tt class="verb">&lt;%= ... %&gt;</tt> это Embedded Ruby  синтаксис, необходимый для оценки выражения Ruby и последующей вставки результата в шаблон. Обратите внимание на символ подчеркивания в имени файла <code>_shim.html.erb</code>; это подчеркивание  - универсальное соглашение для именования частичных шаблонов, которое, среди прочего, позволяет идентифицировать все партиалы в каталоге с первого взгляда.</p>

<p>Конечно, чтобы заполучить частичные шаблоны на работу, мы должны заполнить их чем-нибудь; в случае shim-партиала это просто три строки shim-кода из <a class="ref" href="filling-in-the-layout#code-layout_new_structure">Листинга&nbsp;5.1</a>; результат представлен в <a class="ref" href="filling-in-the-layout#code-stylesheets_partial">Листинге&nbsp;5.9</a>.</p>

<div class="label" id="code-stylesheets_partial"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.9.</span> <span class="description">Частичный шаблон для HTML shim. <br /> <code>app/views/layouts/_shim.html.erb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="c">&lt;!--[if lt IE 9]&gt;</span>
<span class="c">&lt;script src=&quot;http://html5shim.googlecode.com/svn/trunk/html5.js&quot;&gt;&lt;/script&gt;</span>
<span class="c">&lt;![endif]--&gt;</span>
</pre></div>
</div></div>


<p>Аналогичным образом, мы можем переместить материал header-а в частичный шаблон показанный в <a class="ref" href="filling-in-the-layout#code-header_partial">Листинге&nbsp;5.10</a> и вставить его в шаблон другим вызовом <code>render</code>.</p>

<div class="label" id="code-header_partial"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.10.</span> <span class="description">Партиал для header-а сайта. <br /> <code>app/views/layouts/_header.html.erb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;header</span> <span class="na">class=</span><span class="s">&quot;navbar navbar-fixed-top navbar-inverse&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar-inner&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;sample app&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="s2">&quot;logo&quot;</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;nav&gt;</span>
        <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;nav pull-right&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Home&quot;</span><span class="p">,</span>    <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Help&quot;</span><span class="p">,</span>    <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Sign in&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
      <span class="nt">&lt;/nav&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/header&gt;</span>
</pre></div>
</div></div>


<p>Теперь, когда мы знаем как сделать частичные шаблоны, давайте добавим подвал (footer) для каждой страницы сайта, чтобы он шел вместе с шапкой (header). К этому моменту вы, вероятно, догадались, что мы будем называть его <code>_footer.html.erb</code> и поместим его в <code>layouts</code> каталог (<a class="ref" href="filling-in-the-layout#code-footer_partial">Листинг&nbsp;5.11</a>).<sup class="footnote" id="fnref-5_7"><a href="#fn-5_7">7</a></sup></p>

<div class="label" id="code-footer_partial"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.11.</span> <span class="description">Партиал для подвала сайта. <br /> <code>app/views/layouts/_footer.html.erb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;footer</span> <span class="na">class=</span><span class="s">&quot;footer&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;small&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Rails Tutorial<span class="nt">&lt;/a&gt;</span>
    by Michael Hartl
  <span class="nt">&lt;/small&gt;</span>
  <span class="nt">&lt;nav&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
      <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;About&quot;</span><span class="p">,</span>   <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Contact&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://news.railstutorial.org/&quot;</span><span class="nt">&gt;</span>News<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;/nav&gt;</span>
<span class="nt">&lt;/footer&gt;</span>
</pre></div>
</div></div>


<p>Как и в шапке (header), в подвале (footer) мы использовали <code>link_to</code> для внутренних ссылок на About и Contact страницы и заглушили URI-адреса символом <code>&rsquo;#&rsquo;</code> до лучших времен. (Как и <code>header</code>, <code>footer</code>  - новый, HTML5, тег.)</p>

<p>Мы можем вставить партиал подвала в шаблон тем же образом, что и shim и header партиалы (<a class="ref" href="filling-in-the-layout#code-layout_with_footer">Листинг&nbsp;5.12</a>).</p>

<div class="label" id="code-layout_with_footer"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.12.</span> <span class="description">Шаблон сайта с партиалом подвала. <br /> <code>app/views/layouts/application.html.erb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span><span class="cp">&lt;%=</span> <span class="n">full_title</span><span class="p">(</span><span class="k">yield</span><span class="p">(</span><span class="ss">:title</span><span class="p">))</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span>    <span class="s2">&quot;application&quot;</span><span class="p">,</span> <span class="ss">media:</span> <span class="s2">&quot;all&quot;</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s2">&quot;application&quot;</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">csrf_meta_tags</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">&#39;layouts/shim&#39;</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">&#39;layouts/header&#39;</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">&#39;layouts/footer&#39;</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p>Конечно, подвал будет уродливым, если его немного не отстилить (<a class="ref" href="filling-in-the-layout#code-footer_css">Листинг&nbsp;5.13</a>). Результаты представлены на <a class="ref" href="filling-in-the-layout#fig-site_with_footer">Рис.&nbsp;5.7</a>.</p>

<div class="label" id="code-footer_css"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.13.</span> <span class="description">Добавление CSS для подвала сайта. <br /> <code>app/assets/stylesheets/custom.css.scss</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>

<span class="o">/*</span> <span class="nt">footer</span> <span class="o">*/</span>

<span class="nt">footer</span> <span class="p">{</span>
  <span class="na">margin-top</span><span class="o">:</span> <span class="mi">45</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">border-top</span><span class="o">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="no">solid</span> <span class="mh">#eaeaea</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#999</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">footer</span> <span class="nt">a</span> <span class="p">{</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#555</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">footer</span> <span class="nt">a</span><span class="nd">:hover</span> <span class="p">{</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#222</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">footer</span> <span class="nt">small</span> <span class="p">{</span>
  <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">footer</span> <span class="nt">ul</span> <span class="p">{</span>
  <span class="na">float</span><span class="o">:</span> <span class="no">right</span><span class="p">;</span>
  <span class="na">list-style</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">footer</span> <span class="nt">ul</span> <span class="nt">li</span> <span class="p">{</span>
  <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
  <span class="na">margin-left</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div></div>




<div class="label" id="fig-site_with_footer"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/site_with_footer_bootstrap.png" alt="site_with_footer_bootstrap" /></span></div><div class="caption"><span class="header">Рис. 5.7: </span><span class="description">Home страница (<a href="http://localhost:3000/static_pages/home"><tt>/static_pages/home</tt></a>) с добавленным подвалом.&nbsp;<a href="http://railstutorial.org/images/figures/site_with_footer_bootstrap-full.png">(полный размер)</a></span></div></div>




<div class="label" id="sec-sass_and_the_asset_pipeline"></div>


<h2><a id="sec-5_2" href="filling-in-the-layout#sec-sass_and_the_asset_pipeline" class="heading"><span class="number">5.2</span> Sass и файлопровод (asset pipeline)</a></h2>


<p>Одним из наиболее заметных различий между Rails&nbsp;3.0 и более поздними версиями является файлопровод (asset pipeline), который значительно улучшает создание и управление статическими файлами (# assets, активы) такими как CSS, JavaScript и изображения. Этот раздел даст вам общее понимание файлопровода, а затем покажет как использовать удивительный инструмент для создания CSS называемый <em>Sass</em>, теперь уже по умолчанию включенный в Rails как часть файлопровода.</p>

<div class="label" id="sec-the_asset_pipeline"></div>


<h3><a id="sec-5_2_1" href="filling-in-the-layout#sec-the_asset_pipeline" class="heading"><span class="number">5.2.1</span> Файлопровод</a></h3>


<p>Файлопровод включает в себя множество подкапотных изменений в Rails&rsquo;, но с точки зрения типичного Rails разработчика есть три принципиальных момента в которых нужно разобраться: директории ассетов (активов, файлов), файлы-манифесты и препроцессоры.<sup class="footnote" id="fnref-5_8"><a href="#fn-5_8">8</a></sup> Давайте рассмотрим каждый из них по очереди.</p>

<h4><a id="sec-5_2_1_1" href="filling-in-the-layout#sec-5_2_1_1" class="heading">Директории ассетов</a></h4>


<p>В версиях Rails до 3.0 включительно, статические ассеты жили в директории <code>public/</code> следующим образом:</p>

<ul>
<li><code>public/stylesheets</code></li>
<li><code>public/javascripts</code></li>
<li><code>public/images</code></li>
</ul>


<p>Файлы в этих директориях (даже в версиях после-3.0) автоматически выдаются через запрос к http://example.com/stylesheets, и т.д..</p>

<p>Начиная с Rails 3.1, существуют <em>три</em> каноничные директории для статических ассетов, каждая со своим собственным назначением:</p>

<ul>
<li><code>app/assets</code>: ассеты специфичные для данного приложения</li>
<li><code>lib/assets</code>: ассеты для библиотек написанных вашей командой разработчиков</li>
<li><code>vendor/assets</code>: ассеты сторонних поставщиков (програмного обеспечения)</li>
</ul>


<p>Как вы можете догадаться, каждая из этих директорий имеет субдиректории для каждого класса ассетов, например,</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> ls app/assets/
<span class="go">images      javascripts stylesheets</span>
</pre></div>
</div>


<p>Теперь мы в состоянии понять причины по которым мы поместили файл <code>custom.css.scss</code> в директорию app/assets в <a class="ref" href="filling-in-the-layout#sec-custom_css">Разделе&nbsp;5.1.2</a>: <code>custom.css.scss</code> специфичен для примера приложения, поэтому он отправляется в <code>app/assets/stylesheets</code>.</p>

<h4><a id="sec-5_2_1_2" href="filling-in-the-layout#sec-5_2_1_2" class="heading">Файлы-манифесты</a></h4>


<p>После того как вы поместили ваши ассеты в предназначенные им директории, вы можете использовать <em>файлы-манифесты</em> для того, чтобы сказать Rails (с помошью гема <a href="https://github.com/sstephenson/sprockets#">Sprockets</a>) как скомбинировать их для того чтобы сформировать один единственный файл. (Это относится к CSS и JavaScript но не к изображениям.) В качестве примера, давайте взглянем на дефолтный манифест файл для таблиц стилей приложения (<a class="ref" href="filling-in-the-layout#code-app_css_manifest">Листинг&nbsp;5.14</a>).</p>

<div class="label" id="code-app_css_manifest"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.14.</span> <span class="description">Манифест файл для app-specific CSS. <br /> <code>app/assets/stylesheets/application.css</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * This is a manifest file that&#39;ll automatically include all the stylesheets</span>
<span class="cm"> * available in this directory and any sub-directories. You&#39;re free to add</span>
<span class="cm"> * application-wide styles to this file and they&#39;ll appear at the top of the</span>
<span class="cm"> * compiled file, but it&#39;s generally better to create a new file per style </span>
<span class="cm"> * scope.</span>
<span class="cm"> *= require_self</span>
<span class="cm"> *= require_tree . </span>
<span class="cm">*/</span>
</pre></div>
</div></div>


<p>Ключевые строками здесь являются CSS комментарии, но именно они используются Sprockets для включения правильных файлов:</p>

<div class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> .</span>
<span class="cm"> .</span>
<span class="cm"> .</span>
<span class="cm"> *= require_self</span>
<span class="cm"> *= require_tree . </span>
<span class="cm">*/</span>
</pre></div>
</div>


<p>Здесь</p>

<div class="code"><div class="highlight"><pre><span class="go">*= require_tree .</span>
</pre></div>
</div>


<p>обеспечивает включение всех CSS файлов из директории <code>app/assets/stylesheets</code> (в том числе вложенные субдиректории) в CSS приложения. Строка</p>

<div class="code"><div class="highlight"><pre><span class="go">*= require_self</span>
</pre></div>
</div>


<p>гарантирует что также будут включены CSS из файла <code>application.css</code>.</p>

<p>Rails поставляется с вполне вменяемыми дефолтными манифест-файлами и в <em>Rails Tutorial</em> мы не будем изменять их, но в случае если вам понадобится их изменить, см. <a href="http://rusrails.ru/asset-pipeline">(rus)Rails Guides введение в asset pipeline</a> чтобы узнать об этом подробнее.</p>

<h4><a id="sec-5_2_1_3" href="filling-in-the-layout#sec-5_2_1_3" class="heading">Препроцессоры</a></h4>


<p>После того как вы собрали ваши активы, Rails подготавливает их для шаблона сайта, прогоняя их через несколько препроцессоров и комбинирует их с помощью манифест-файлов для доставки в браузер. Мы говорим Rails какой препроцессор использовать с помощью расширения файла; наиболее употребительными являются <code>.scss</code> для Sass, <code>.coffee</code> для CoffeeScript и <code>.erb</code> для встроенного Ruby (ERb). Мы впервые рассказыали о  ERb в <a class="ref" href="static-pages#sec-embedded_ruby">Разделе&nbsp;3.3.3</a> и о Sass в <a class="ref" href="filling-in-the-layout#sec-sass">Разделе&nbsp;5.2.2</a>. В этом учебнике нам не понадобится CoffeeScript. Если вам интересно узнать об
этом элегантном маленьком языке который компилируется в JavaScript, советую начать с <a href="http://railscasts.com/episodes/267-coffeescript-basics">RailsCast on CoffeeScript basics</a>.</p>

<p>Препроцессоры могут быть сцеплены, например</p>

<p><code>foobar.js.coffee</code></p>

<p>прогоняется через препроцессор CoffeeScript, а</p>

<p><code>foobar.js.erb.coffee</code></p>

<p>прогоняется и через CoffeeScript и через ERb (справа налево, т.е. CoffeeScript первым).</p>

<h4><a id="sec-5_2_1_4" href="filling-in-the-layout#sec-5_2_1_4" class="heading">Производительность в продакшен</a></h4>


<p>Одно из самых замечательных свойств файлопровода, в том что он автоматически приводит к повышению производительности в продакшен приложении. Традиционный подход к организации CSS и JavaScript подразумевает разбиение функциональности между отдельными файлами и использование приятного глазу форматирования  (с большим количеством отступов). Что является удобным для программистов, но неэффективно в продакшен; включение множества крупноразмерных файлов может серьезно увеличить время загрузки страниц (а это один из наиболее значимых факторов влияющих на впечатление получаемое пользователями от сайта). С файлопроводом, в продакшен все таблицы стилей приложения заворачиваются в один  CSS файл (<code>application.css</code>), весь JavaScript код приложения заворачивается в один JavaScript файл (<code>javascripts.js</code>) и все подобные файлы (включая и те что хранятся в <code>lib/assets</code> и <code>vendor/assets</code>) <em>минимизируются</em> для удаления ненужных пробелов увеличивающих размер файла. В результате мы получаем лучшее для обоих миров: множество хорошо отформатированных файлов для удобства программистов и объединенные в один, оптимизированные файлы для продакшен.</p>

<div class="label" id="sec-sass"></div>


<h3><a id="sec-5_2_2" href="filling-in-the-layout#sec-sass" class="heading"><span class="number">5.2.2</span> Синтаксически обалденные таблицы стилей</a></h3>


<p><em>Sass</em> это язык для написания таблиц стилей который во многом улучшает CSS. В этом разделе мы узнаем о двух наиболее важных улучшениях: <em>вложенности</em> и <em>переменных</em>. (Третья техника, <em>примеси</em>, представлена в <a class="ref" href="sign-up#sec-rails_environments">Разделе&nbsp;7.1.1</a>.)</p>

<p>Как было вкратце отмечено в <a class="ref" href="filling-in-the-layout#sec-custom_css">Разделе&nbsp;5.1.2</a>, Sass поддерживает формат называемый SCSS (обозначается расширением файла <code>.scss</code>), который является расширерением самого CSS; то есть, SCSS только <em>добавляет</em> возможности к CSS, вместо определения совершенного синтаксиса.<sup class="footnote" id="fnref-5_9"><a href="#fn-5_9">9</a></sup> Это означает, что любой валидный CSS файл будет валидным SCSS файлом, что удобно для проектов с уже написанным стилем. В нашем случае мы использовали SCSS с самого начала для совместимости с Bootstrap. Поскольку файлопровод в Rails автоматически использует Sass для обработки файлов с <code>.scss</code> расширением, файл <code>custom.css.scss</code> будет пропущен через препроцессор Sass прежде чем он будет упакован для доставки в браузер.</p>

<h4><a id="sec-5_2_2_1" href="filling-in-the-layout#sec-5_2_2_1" class="heading">Вложение</a></h4>


<p>Общепринятым паттерном в написании таблиц стилей являются правила применяемые ко вложенным элементам. Например, в <a class="ref" href="filling-in-the-layout#code-universal_css">Листинге&nbsp;5.5</a> у нас есть правило применяемое и для <code>.center</code> и для <code>.center h1</code>:</p>

<div class="code"><div class="highlight"><pre><span class="nc">.center</span> <span class="p">{</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.center</span> <span class="nt">h1</span> <span class="p">{</span>
  <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>


<p>В Sass мы можем заменить это на</p>

<div class="code"><div class="highlight"><pre><span class="nc">.center</span> <span class="p">{</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
  <span class="nt">h1</span> <span class="p">{</span>
    <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>


<p>Здесь вложенное правило <code>h1</code> наследует контекст правила <code>.center</code>.</p>

<p>Здесь есть второй кандидат на вложение, который требует несколько иного синтаксиса. В <a class="ref" href="filling-in-the-layout#code-logo_css">Листинге&nbsp;5.7</a>, мы имеем код</p>

<div class="code"><div class="highlight"><pre><span class="nn">#logo</span> <span class="p">{</span>
  <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
  <span class="na">margin-right</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.7</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#fff</span><span class="p">;</span>
  <span class="na">text-transform</span><span class="o">:</span> <span class="no">uppercase</span><span class="p">;</span>
  <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-1</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">9</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">font-weight</span><span class="o">:</span> <span class="no">bold</span><span class="p">;</span>
  <span class="na">line-height</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="nn">#logo</span><span class="nd">:hover</span> <span class="p">{</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#fff</span><span class="p">;</span>
  <span class="na">text-decoration</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>


<p>Здесь id логотипа <code>#logo</code> используется дважды, в первый раз сам по себе и второй раз с атрибутом <code>hover</code> (который отвечает за его внешний вид при наведении курсора). Для того чтобы вложить второе правило нам необходимо сослаться на родительский элемент <code>#logo</code>; в SCSS это достигается с помощью символа&nbsp;<code>&amp;</code> следующим образом:</p>

<div class="code"><div class="highlight"><pre><span class="nn">#logo</span> <span class="p">{</span>
  <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
  <span class="na">margin-right</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.7</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#fff</span><span class="p">;</span>
  <span class="na">text-transform</span><span class="o">:</span> <span class="no">uppercase</span><span class="p">;</span>
  <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-1</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">9</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">font-weight</span><span class="o">:</span> <span class="no">bold</span><span class="p">;</span>
  <span class="na">line-height</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">&amp;</span><span class="nd">:hover</span> <span class="p">{</span>
    <span class="na">color</span><span class="o">:</span> <span class="mh">#fff</span><span class="p">;</span>
    <span class="na">text-decoration</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>


<p>Sass заменяет <code>&amp;:hover</code> на <code>#logo:hover</code> при конвертации из SCSS в CSS.</p>

<p>Обе эти техники вложения элементов применяются в CSS подвала в  <a class="ref" href="filling-in-the-layout#code-footer_css">Листинге&nbsp;5.13</a>, который может быть трансформирован в следующее:</p>

<div class="code"><div class="highlight"><pre><span class="nt">footer</span> <span class="p">{</span>
  <span class="na">margin-top</span><span class="o">:</span> <span class="mi">45</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">border-top</span><span class="o">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="no">solid</span> <span class="mh">#eaeaea</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#999</span><span class="p">;</span>
  <span class="nt">a</span> <span class="p">{</span>
    <span class="na">color</span><span class="o">:</span> <span class="mh">#555</span><span class="p">;</span>
    <span class="k">&amp;</span><span class="nd">:hover</span> <span class="p">{</span>
      <span class="na">color</span><span class="o">:</span> <span class="mh">#222</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nt">small</span> <span class="p">{</span>
    <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nt">ul</span> <span class="p">{</span>
    <span class="na">float</span><span class="o">:</span> <span class="no">right</span><span class="p">;</span>
    <span class="na">list-style</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span>
    <span class="nt">li</span> <span class="p">{</span>
      <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
      <span class="na">margin-left</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>


<p>Конвертирование <a class="ref" href="filling-in-the-layout#code-footer_css">Листинга&nbsp;5.13</a> вручную это хорошее упражнение и вы должны убедиться что CSS по прежнему работает как надо после преобразования.</p>

<h4><a id="sec-5_2_2_2" href="filling-in-the-layout#sec-5_2_2_2" class="heading">Переменные</a></h4>


<p>Sass позволяет нам определять <em>переменные</em> для устранения дублирования и написания более выразительного кода. Для примера, взгляните на <a class="ref" href="filling-in-the-layout#code-typography_css">Листинг&nbsp;5.6</a> и <a class="ref" href="filling-in-the-layout#code-footer_css">Листинг&nbsp;5.13</a>, мы видим, что здесь есть повторяющийся вызов одного и того же цвета:</p>

<div class="code"><div class="highlight"><pre><span class="nt">h2</span> <span class="p">{</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#999</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nt">footer</span> <span class="p">{</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#999</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>



<p>В данном случае, <code>#999</code> это светло серый цвет, и мы можем дать ему имя, определив переменную следующим образом:</p>

<div class="code"><div class="highlight"><pre><span class="nv">$lightGray</span><span class="o">:</span> <span class="mh">#999</span><span class="p">;</span>
</pre></div>
</div>


<p>Это позволяет нам переписать наш SCSS следующим образом:</p>

<div class="code"><div class="highlight"><pre><span class="nv">$lightGray</span><span class="o">:</span> <span class="mh">#999</span><span class="p">;</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nt">h2</span> <span class="p">{</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">color</span><span class="o">:</span> <span class="nv">$lightGray</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nt">footer</span> <span class="p">{</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">color</span><span class="o">:</span> <span class="nv">$lightGray</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>


<p>Поскольку названия переменных, такие как <code>$lightGray</code> являются более говорящими, нежели <code>#999</code>, часто бывает полезным определять переменные даже для не повторяющихся значений. Действительно, фреймворк Bootstrap определяет большое количество переменных для цветов, вы можете ознакомиться с ними онлайн на странице <a href="http://twitter.github.com/bootstrap/less.html#variables">LESS variables</a>. Эта страница определяеет переменные используя LESS, а не Sass, но гем <tt>bootstrap-sass</tt> обеспечивает нас их Sass эквивалентами. Угадать соответствие несложно; там где LESS использует знак &ldquo;at&rdquo; (&nbsp;<code>@</code>), Sass использует знак доллара&nbsp;<code>$</code>. Глядя на страницу Bootstrap с переменными, мы видим, что переменная для светло-серого цвета уже существует:</p>

<div class="code"><div class="highlight"><pre> <span class="k">@grayLight</span><span class="nd">:</span> <span class="nn">#999</span><span class="o">;</span>
</pre></div>
</div>


<p>Это означает, что, благодаря гему <tt>bootstrap-sass</tt> должна существовать соответствующая SCSS переменная <code>$grayLight</code>. Мы можем использовать ее для замены нашей кастомной переменной, <code>$lightGray</code>, что дает нам</p>

<div class="code"><div class="highlight"><pre><span class="nt">h2</span> <span class="p">{</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">color</span><span class="o">:</span> <span class="nv">$grayLight</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nt">footer</span> <span class="p">{</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">color</span><span class="o">:</span> <span class="nv">$grayLight</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>


<p>Применение Sass вложения и определения переменных ко всему SCSS файлу дает нам файл представленный в <a class="ref" href="filling-in-the-layout#code-refactored_scss">Листинге&nbsp;5.15</a>. Это использует Sass переменные (как определенные в Bootstrap) так и встроенные названия цветов (т.е., <code>white</code> для <code>#fff</code>). Обратите внимание, в частности, на кардинальное улучшение в правилах для тега <code>footer</code>.</p>

<div class="label" id="code-refactored_scss"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.15.</span> <span class="description">Начальный SCSS сконвертированный для использования вложенностей и переменных. <br /> <code>app/assets/stylesheets/custom.css.scss</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">@import</span> <span class="s2">&quot;bootstrap&quot;</span><span class="p">;</span>

<span class="cm">/* mixins, variables, etc. */</span>

<span class="nv">$grayMediumLight</span><span class="o">:</span> <span class="mh">#eaeaea</span><span class="p">;</span>

<span class="cm">/* universal */</span>

<span class="nt">html</span> <span class="p">{</span>
  <span class="na">overflow-y</span><span class="o">:</span> <span class="no">scroll</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">body</span> <span class="p">{</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">60</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">section</span> <span class="p">{</span>
  <span class="na">overflow</span><span class="o">:</span> <span class="no">auto</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">textarea</span> <span class="p">{</span>
  <span class="na">resize</span><span class="o">:</span> <span class="n">vertical</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.center</span> <span class="p">{</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
  <span class="nt">h1</span> <span class="p">{</span>
    <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* typography */</span>

<span class="nt">h1</span><span class="o">,</span> <span class="nt">h2</span><span class="o">,</span> <span class="nt">h3</span><span class="o">,</span> <span class="nt">h4</span><span class="o">,</span> <span class="nt">h5</span><span class="o">,</span> <span class="nt">h6</span> <span class="p">{</span>
  <span class="na">line-height</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">h1</span> <span class="p">{</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">3</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-2</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">30</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">h2</span> <span class="p">{</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.7</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-1</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">30</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
  <span class="na">font-weight</span><span class="o">:</span> <span class="no">normal</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="nv">$grayLight</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">p</span> <span class="p">{</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.1</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">line-height</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.7</span><span class="kt">em</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/* header */</span>

<span class="nn">#logo</span> <span class="p">{</span>
  <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
  <span class="na">margin-right</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.7</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="nb">white</span><span class="p">;</span>
  <span class="na">text-transform</span><span class="o">:</span> <span class="no">uppercase</span><span class="p">;</span>
  <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-1</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">9</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">font-weight</span><span class="o">:</span> <span class="no">bold</span><span class="p">;</span>
  <span class="na">line-height</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">&amp;</span><span class="nd">:hover</span> <span class="p">{</span>
    <span class="na">color</span><span class="o">:</span> <span class="nb">white</span><span class="p">;</span>
    <span class="na">text-decoration</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* footer */</span>

<span class="nt">footer</span> <span class="p">{</span>
  <span class="na">margin-top</span><span class="o">:</span> <span class="mi">45</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">border-top</span><span class="o">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="no">solid</span> <span class="nv">$grayMediumLight</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="nv">$grayLight</span><span class="p">;</span>
  <span class="nt">a</span> <span class="p">{</span>
    <span class="na">color</span><span class="o">:</span> <span class="nv">$gray</span><span class="p">;</span>
    <span class="k">&amp;</span><span class="nd">:hover</span> <span class="p">{</span>
      <span class="na">color</span><span class="o">:</span> <span class="nv">$grayDarker</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nt">small</span> <span class="p">{</span>
    <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nt">ul</span> <span class="p">{</span>
    <span class="na">float</span><span class="o">:</span> <span class="no">right</span><span class="p">;</span>
    <span class="na">list-style</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span>
    <span class="nt">li</span> <span class="p">{</span>
      <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
      <span class="na">margin-left</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div></div>


<p>Sass дает нам гораздо больше способов для упрощения наших таблиц стилей, но код в <a class="ref" href="filling-in-the-layout#code-refactored_scss">Листинге&nbsp;5.15</a> использует наиболее важные из них и дает нам хороший старт. Более подробно об этом см. на <a href="http://sass-lang.com/">сайте Sass</a>.</p>

<div class="label" id="sec-layout_links"></div>


<h2><a id="sec-5_3" href="filling-in-the-layout#sec-layout_links" class="heading"><span class="number">5.3</span> Ссылки в шаблоне</a></h2>


<p>Теперь, когда мы закончили шаблон сайта с достойным стилем, пришло время приступить к заполнению ссылок которые  мы заглушили символом <code>&rsquo;#&rsquo;</code>. Конечно, мы могли бы просто захардкодить ссылки:</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/static_pages/about&quot;</span><span class="nt">&gt;</span>About<span class="nt">&lt;/a&gt;</span>
</pre></div>
</div>


<p>но это не Rails Way.  Было бы хорошо, если бы URI для about страницы был <tt>/about</tt>, а не <tt>/pages/about</tt>; причем, Rails конвенционально использует <em>named routes</em> (именованные маршруты), которые включают в себя код, подобный</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;About&quot;</span><span class="p">,</span> <span class="n">about_path</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>Таким образом код обретает более прозрачный смысл и, к тому же, это более гибкий подход, поскольку мы можем изменить определение <code>about_path</code> и URI изменятся везде где используется <code>about_path</code>.</p>

<p>Полный список наших запланированных ссылок представлен в <a class="ref" href="filling-in-the-layout#table-url_mapping">Таблице&nbsp;5.1</a>, вместе с соответствием URI и маршрутов. Со временем, мы реализуем все ссылки, но предпоследнюю мы добавим только в конце этой главы, а последняя будет создана лишь в <a class="ref" href="sign-in-sign-out#top">Главе&nbsp;8</a>.</p>

<div class="label" id="table-url_mapping"></div>


<div class="table"><div class="center">
<table class="tabular"><tr><th class="align_left"><strong>Page</strong></th><th class="align_left"><strong>URI</strong></th><th class="align_right"><strong>Named route</strong></th></tr><tr class="top_bar"><td class="align_left">Home</td><td class="align_left">/</td><td class="align_right"><code>root_path</code></td></tr><tr><td class="align_left">About</td><td class="align_left">/about</td><td class="align_right"><code>about_path</code></td></tr><tr><td class="align_left">Help</td><td class="align_left">/help</td><td class="align_right"><code>help_path</code></td></tr><tr><td class="align_left">Contact</td><td class="align_left">/contact</td><td class="align_right"><code>contact_path</code></td></tr><tr><td class="align_left">Sign up</td><td class="align_left">/signup</td><td class="align_right"><code>signup_path</code></td></tr><tr><td class="align_left">Sign in</td><td class="align_left">/signin</td><td class="align_right"><code>signin_path</code></td></tr></table></div><div class="caption"><span class="header">Таблица 5.1: </span><span class="description">Маршруты и соответствующие им URI для ссылок сайта.</span></div></div>


<p>Прежде чем двигаться дальше, давайте добавим страницу Contact (было оставлено в качестве упражнения в  <a class="ref" href="static-pages#top">Главе&nbsp;3</a>). Тесты представлены в <a class="ref" href="filling-in-the-layout#code-contact_page_test">Листинге&nbsp;5.16</a>; они просто следуют модели из <a class="ref" href="static-pages#code-pages_controller_spec_title">Листинга&nbsp;3.18</a>. Обратите внимание на то что в коде приложения в  <a class="ref" href="filling-in-the-layout#code-contact_page_test">Листинге&nbsp;5.16</a> мы переключились на Ruby&nbsp;1.9 &ndash; стиль хэшей.</p>

<div class="label" id="code-contact_page_test"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.16.</span> <span class="description">Тесты для страницы Contact. <br /> <code>spec/requests/static_pages_spec.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="s2">&quot;Static pages&quot;</span> <span class="k">do</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="n">describe</span> <span class="s2">&quot;Contact page&quot;</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s2">&quot;should have the h1 &#39;Contact&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="s1">&#39;/static_pages/contact&#39;</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">&#39;Contact&#39;</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the title &#39;Contact&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="s1">&#39;/static_pages/contact&#39;</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span>
                    <span class="ss">text:</span> <span class="s2">&quot;Ruby on Rails Tutorial Sample App | Contact&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Вам следует проверить что эти тесты в красном:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/static_pages_spec.rb
</pre></div>
</div>


<p>Код приложения параллелен коду для добавления страницы About в <a class="ref" href="static-pages#sec-adding_a_page">Разделе&nbsp;3.2.2</a>: вначале мы обновляем маршруты (<a class="ref" href="filling-in-the-layout#code-contact_route">Листинг&nbsp;5.17</a>), затем добавляем <code>contact</code> действие в контроллер StaticPages (<a class="ref" href="filling-in-the-layout#code-contact_action">Листинг&nbsp;5.18</a>) и, наконец, мы создаем представление Contact (<a class="ref" href="filling-in-the-layout#code-contact_view">Листинг&nbsp;5.19</a>).</p>

<div class="label" id="code-contact_route"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.17.</span> <span class="description">Добавление маршрута для страницы Contact. <br /> <code>config/routes.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="ss">SampleApp::Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s2">&quot;static_pages/home&quot;</span>
  <span class="n">get</span> <span class="s2">&quot;static_pages/help&quot;</span>
  <span class="n">get</span> <span class="s2">&quot;static_pages/about&quot;</span>
  <span class="n">get</span> <span class="s2">&quot;static_pages/contact&quot;</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code-contact_action"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.18.</span> <span class="description">Добавление действия для страницы Contact. <br /> <code>app/controllers/static_pages_controller.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">StaticPagesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="k">def</span> <span class="nf">contact</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code-contact_view"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.19.</span> <span class="description">Представление для страницы Contact. <br /> <code>app/views/static_pages/contact.html.erb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="n">provide</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="s1">&#39;Contact&#39;</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;h1&gt;</span>Contact<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>
  Contact Ruby on Rails Tutorial about the sample app at the
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/contact&quot;</span><span class="nt">&gt;</span>contact page<span class="nt">&lt;/a&gt;</span>.
<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>


<p>Теперь убедитесь что тесты проходят:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/static_pages_spec.rb
</pre></div>
</div>




<div class="label" id="sec-route_tests"></div>


<h3><a id="sec-5_3_1" href="filling-in-the-layout#sec-route_tests" class="heading"><span class="number">5.3.1</span> Тестирование маршрутов</a></h3>


<p>С работой которую мы проделали при написании интеграционных тестов для статических страниц, написание тестов для маршрутов довольно простая задача: мы просто заменяем каждое упоминание жестко прописанных адресов на соответствующие именованные маршруты из <a class="ref" href="filling-in-the-layout#table-url_mapping">Таблицы&nbsp;5.1</a>. Другими словами, мы меняем</p>

<div class="code"><div class="highlight"><pre><span class="n">visit</span> <span class="s1">&#39;/static_pages/about&#39;</span>
</pre></div>
</div>


<p>на</p>

<div class="code"><div class="highlight"><pre><span class="n">visit</span> <span class="n">about_path</span>
</pre></div>
</div>


<p>и так далее для остальных страниц. Результат представлен в <a class="ref" href="filling-in-the-layout#code-route_tests">Листинге&nbsp;5.20</a>.</p>

<div class="label" id="code-route_tests"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.20.</span> <span class="description">Тесты для именованных маршрутов. <br /> <code>spec/requests/static_pages_spec.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="s2">&quot;Static pages&quot;</span> <span class="k">do</span>

  <span class="n">describe</span> <span class="s2">&quot;Home page&quot;</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s2">&quot;should have the h1 &#39;Sample App&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="n">root_path</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">&#39;Sample App&#39;</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the base title&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="n">root_path</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span>
                        <span class="ss">text:</span> <span class="s2">&quot;Ruby on Rails Tutorial Sample App&quot;</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should not have a custom page title&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="n">root_path</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should_not</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">&#39;| Home&#39;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;Help page&quot;</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s2">&quot;should have the h1 &#39;Help&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="n">help_path</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">&#39;Help&#39;</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the title &#39;Help&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="n">help_path</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span>
                        <span class="ss">text:</span> <span class="s2">&quot;Ruby on Rails Tutorial Sample App | Help&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;About page&quot;</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s2">&quot;should have the h1 &#39;About&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="n">about_path</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">&#39;About Us&#39;</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the title &#39;About Us&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="n">about_path</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span>
                    <span class="ss">text:</span> <span class="s2">&quot;Ruby on Rails Tutorial Sample App | About Us&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;Contact page&quot;</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s2">&quot;should have the h1 &#39;Contact&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="n">contact_path</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">&#39;Contact&#39;</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the title &#39;Contact&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="n">contact_path</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span>
                    <span class="ss">text:</span> <span class="s2">&quot;Ruby on Rails Tutorial Sample App | Contact&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Как обычно, вам следует проверить, что тесты сейчас покраснели:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/static_pages_spec.rb
</pre></div>
</div>


<p>Кстати, если код в <a class="ref" href="filling-in-the-layout#code-route_tests">Листинге&nbsp;5.20</a> удивляет вас своими повторениями и многословностью, вы не одиноки. Мы отрефакторим эту грязь в красивую драгоценность в <a class="ref" href="filling-in-the-layout#sec-pretty_rspec">Разделе&nbsp;5.3.4</a>.</p>

<div class="label" id="sec-rails_routes"></div>


<h3><a id="sec-5_3_2" href="filling-in-the-layout#sec-rails_routes" class="heading"><span class="number">5.3.2</span> Rails маршруты</a></h3>


<p>Теперь, когда у нас есть нужные нам тесты для URI, пришло время заставить их работать. Как отмечалось в <a class="ref" href="static-pages#sec-static_pages_with_rails">Разделе&nbsp;3.1.2</a>, Rails использует для маршрутов файл <code>config/routes.rb</code>. Если вы посмотрите на дефолтный, файл routes.rb, вы увидите беспорядок, но это полезный беспорядок — полный закомментированных примеров маршрутов. Я советую почитать его как-нибудь, а также взглянуть на <a href="http://rusrails.ru/rails-routing">статью о маршрутах в (rus)Rails Guides</a> для более углубленного изучения маршрутов.</p>

<p>Для того чтобы определить именованные маршруты нам необходимо заменить такие маршруты как</p>

<div class="code"><div class="highlight"><pre><span class="n">get</span> <span class="s1">&#39;static_pages/help&#39;</span>
</pre></div>
</div>


<p>на</p>

<div class="code"><div class="highlight"><pre><span class="n">match</span> <span class="s1">&#39;/help&#39;</span><span class="p">,</span> <span class="ss">to:</span> <span class="s1">&#39;static_pages#help&#39;</span>
</pre></div>
</div>


<p>Это дает нам два варианта возможных варианта написания пути к странице help: <code>/help</code> и именованный маршрут <code>help_path</code> который возвращает путь к этой странице. (На самом деле использование <code>get</code> вместо <code>match</code> даст тот же именованнный маршрут, но использование <code>match</code> более принято.)</p>

<p>Применение этого паттерна к остальным статическим страницам приводит нас к <a class="ref" href="filling-in-the-layout#code-static_page_routes">Листингу&nbsp;5.21</a>. Единственным исключением здесь является страница Home, о которой мы позаботимся в  <a class="ref" href="filling-in-the-layout#code-root_route">Листинге&nbsp;5.23</a>.</p>

<div class="label" id="code-static_page_routes"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.21.</span> <span class="description">Маршруты для статических страниц. <br /> <code>config/routes.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="ss">SampleApp::Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">match</span> <span class="s1">&#39;/help&#39;</span><span class="p">,</span>    <span class="ss">to:</span> <span class="s1">&#39;static_pages#help&#39;</span>
  <span class="n">match</span> <span class="s1">&#39;/about&#39;</span><span class="p">,</span>   <span class="ss">to:</span> <span class="s1">&#39;static_pages#about&#39;</span>
  <span class="n">match</span> <span class="s1">&#39;/contact&#39;</span><span class="p">,</span> <span class="ss">to:</span> <span class="s1">&#39;static_pages#contact&#39;</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Если вы внимательно почитаете код в <a class="ref" href="filling-in-the-layout#code-static_page_routes">Листинге&nbsp;5.21</a>, вы возможно сможете понять что он делает; например, вы можете увидеть что</p>

<div class="code"><div class="highlight"><pre><span class="n">match</span> <span class="s1">&#39;/about&#39;</span><span class="p">,</span> <span class="ss">to:</span> <span class="s1">&#39;static_pages#about&#39;</span>
</pre></div>
</div>


<p>устанавливает соответствие между <code>&rsquo;/about&rsquo;</code> и именованным маршрутом, а также направляет его в <code>about</code> действие контроллера StaticPages. Прежде это было более очевидно: мы использовали</p>

<div class="code"><div class="highlight"><pre><span class="n">get</span> <span class="s1">&#39;static_pages/about&#39;</span>
</pre></div>
</div>

 <p> для того чтобы попасть в то же место, но <code>/about</code> более краток. В дополнение, как отмечалось выше, код <code>match &rsquo;/about&rsquo;</code> также автоматически создает <em>именованные маршруты</em> для использования в контроллерах и представлениях:</p>

<div class="code"><div class="highlight"><pre><span class="n">about_path</span> <span class="o">=&gt;</span> <span class="s1">&#39;/about&#39;</span>
<span class="n">about_url</span>  <span class="o">=&gt;</span> <span class="s1">&#39;http://localhost:3000/about&#39;</span>
</pre></div>
</div>


<p>Обратите внимание, что <code>about_url</code> это <em>полный</em> URI <tt>http://localhost:3000/about</tt> (<code>localhost:3000</code> заменится на доменное имя, такое как <code>example.com</code>, для развернутого сайта). Как обсуждалось в <a class="ref" href="filling-in-the-layout#sec-layout_links">Разделе&nbsp;5.3</a>, для того чтобы получить просто <tt>/about</tt>, вы используете <code>about_path</code>. (<em>Rails Tutorial</em> использует <code>path</code> форму по соглашению, но разница редко имеет значение на практике (т.е также возможно применение _url формы).)</p>

<p>После определения этих маршрутов тесты для About, Contact, и Help страниц должны пройти:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/static_pages_spec.rb
</pre></div>
</div>


<p>Это оставляет один провальный тест для страницы Home.</p>

<p>Для маршрута Home страницы мы <em>могли бы</em> использовать код вроде этого:</p>

<div class="code"><div class="highlight"><pre><span class="n">match</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="ss">to:</span> <span class="s1">&#39;static_pages#home&#39;</span>
</pre></div>
</div>


<p>Однако делать этого не придется; Rails имеет специальный маршрут для корневого URI&nbsp;<tt>/</tt> (&ldquo;слэш&rdquo;) расположенный внизу файла (<a class="ref" href="filling-in-the-layout#code-root_route_hint">Листинг&nbsp;5.22</a>).</p>

<div class="label" id="code-root_route_hint"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.22.</span> <span class="description">Закомментированная подсказка для определения root маршрута. <br /> <code>config/routes.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="ss">SampleApp::Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="c1"># You can have the root of your site routed with &quot;root&quot;</span>
  <span class="c1"># just remember to delete public/index.html.</span>
  <span class="c1"># root :to =&gt; &quot;welcome#index&quot;</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Используя <a class="ref" href="filling-in-the-layout#code-root_route_hint">Листинг&nbsp;5.22</a> как модель, мы приходим к <a class="ref" href="filling-in-the-layout#code-root_route">Листингу&nbsp;5.23</a> чтобы направить корневой URI&nbsp;<tt>/</tt> к Home странице.</p>

<div class="label" id="code-root_route"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.23.</span> <span class="description">Добавление соответствия для root маршрута. <br /> <code>config/routes.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="ss">SampleApp::Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">root</span> <span class="ss">to:</span> <span class="s1">&#39;static_pages#home&#39;</span>

  <span class="n">match</span> <span class="s1">&#39;/help&#39;</span><span class="p">,</span>    <span class="ss">to:</span> <span class="s1">&#39;static_pages#help&#39;</span>
  <span class="n">match</span> <span class="s1">&#39;/about&#39;</span><span class="p">,</span>   <span class="ss">to:</span> <span class="s1">&#39;static_pages#about&#39;</span>
  <span class="n">match</span> <span class="s1">&#39;/contact&#39;</span><span class="p">,</span> <span class="ss">to:</span> <span class="s1">&#39;static_pages#contact&#39;</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Этот код направляет корневой URI&nbsp;<tt>/</tt> к <tt>/static_pages/home</tt> и дает нам URI хелперы:</p>

<div class="code"><div class="highlight"><pre><span class="n">root_path</span> <span class="o">=&gt;</span> <span class="s1">&#39;/&#39;</span>
<span class="n">root_url</span>  <span class="o">=&gt;</span> <span class="s1">&#39;http://localhost:3000/&#39;</span>
</pre></div>
</div>


<p>Мы должны также прислушаться к коментарию в <a class="ref" href="filling-in-the-layout#code-root_route_hint">Листинге&nbsp;5.22</a> и удалить <code>public/index.html</code> чтобы предотвратить отображение дефолтной страницы (<a class="ref" href="beginning#fig-riding_rails_31">Рис.&nbsp;1.3</a>) при посещении&nbsp;<tt>/</tt>. Вы можете, конечно, просто удалить файл поместив его в корзину, но если вы используете Git для контроля версий, есть способ удалить файл и в тоже время сообщить Git об удалении&nbsp;&mdash;&nbsp;с помощью <code>git rm</code>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git rm public/index.html
</pre></div>
</div>

<p>При этом, все маршруты для статических страниц работают, и тесты должны пройти:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/static_pages_spec.rb
</pre></div>
</div>


<p>Теперь нам осталось просто заполнить ссылки в макете.</p>

<div class="label" id="sec-named_routes"></div>


<h3><a id="sec-5_3_3" href="filling-in-the-layout#sec-named_routes" class="heading"><span class="number">5.3.3</span> Именованные маршруты</a></h3>


<p>Давайте применим именованные маршруты, созданные в <a class="ref" href="filling-in-the-layout#sec-rails_routes">Разделе&nbsp;5.3.2</a>. Это повлечет за собой заполнение второго аргумента <code>link_to</code> функции правильным именованным маршрутом. Например, мы конвертируем</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;About&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>в</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;About&quot;</span><span class="p">,</span> <span class="n">about_path</span> <span class="cp">%&gt;</span>
</pre></div>
</div>

<p>и так далее.</p>

<p>Мы начнем с партиала <code>_header.html.erb</code> (<a class="ref" href="filling-in-the-layout#code-header_partial_links">Листинг&nbsp;5.24</a>), который содержит ссылки на Home и Help страницы. Пока мы здесь, мы также, следуя общей конвенции Сети, свяжем логотип с Home страницей.</p>

<div class="label" id="code-header_partial_links"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.24.</span> <span class="description">Партиал _header со ссылками. <br /> <code>app/views/layouts/_header.html.erb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;header</span> <span class="na">class=</span><span class="s">&quot;navbar navbar-fixed-top navbar-inverse&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar-inner&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;sample app&quot;</span><span class="p">,</span> <span class="n">root_path</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="s2">&quot;logo&quot;</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;nav&gt;</span>
        <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;nav pull-right&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Home&quot;</span><span class="p">,</span>    <span class="n">root_path</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Help&quot;</span><span class="p">,</span>    <span class="n">help_path</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Sign in&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
      <span class="nt">&lt;/nav&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/header&gt;</span>
</pre></div>
</div></div>


<p>У нас не будет именованного маршрута для &ldquo;Sign in&rdquo; ссылки, до <a class="ref" href="sign-in-sign-out#top">Главы&nbsp;8</a>, поэтому мы пока оставили ее в виде&nbsp;<code>&rsquo;#&rsquo;</code>.</p>

<p>Другим местом со ссылками является партиал подвала, <code>_footer.html.erb</code>, в котором есть ссылки для About и Contact страниц (<a class="ref" href="filling-in-the-layout#code-footer_partial_links">Листинг&nbsp;5.25</a>).</p>

<div class="label" id="code-footer_partial_links"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.25.</span> <span class="description">Партиал _footer со ссылками. <br /> <code>app/views/layouts/_footer.html.erb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;footer</span> <span class="na">class=</span><span class="s">&quot;footer&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;small&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Rails Tutorial<span class="nt">&lt;/a&gt;</span>
    by Michael Hartl
  <span class="nt">&lt;/small&gt;</span>
  <span class="nt">&lt;nav&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
      <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;About&quot;</span><span class="p">,</span>   <span class="n">about_path</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Contact&quot;</span><span class="p">,</span> <span class="n">contact_path</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://news.railstutorial.org/&quot;</span><span class="nt">&gt;</span>News<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;/nav&gt;</span>
<span class="nt">&lt;/footer&gt;</span>
</pre></div>
</div></div>


<p>Теперь наш макет имеет ссылки на все статические страницы созданные в <a class="ref" href="static-pages#top">Главе&nbsp;3</a>, так, например, <a href="http://localhost:3000/about"><tt>/about</tt></a> ведет к About  странице (<a class="ref" href="filling-in-the-layout#fig-about_page">Рис.&nbsp;5.8</a>).</p>

<p>Кстати, стоит отметить, что мы на самом деле не протестировали на наличие ссылок в шаблоне, наши тесты будут провальными, только если маршруты не определены. Вы можете проверить это, закомментировав один из маршрутов в <a class="ref" href="filling-in-the-layout#code-static_page_routes">Листинге&nbsp;5.21</a> и выполнив тесты. Метод тестирования, который на самом деле обеспечивает уверенность что ссылки существуют и отправляют в правильные места, см. в <a class="ref" href="filling-in-the-layout#sec-layout_exercises">Разделе&nbsp;5.6</a>.</p>

<div class="label" id="fig-about_page"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/about_page_styled.png" alt="about_page_styled" /></span></div><div class="caption"><span class="header">Рис. 5.8: </span><span class="description">About страница на  <a href="http://localhost:3000/about"><tt>/about</tt></a>.&nbsp;<a href="http://railstutorial.org/images/figures/about_page_styled-full.png">(полный размер)</a></span></div></div>




<div class="label" id="sec-pretty_rspec"></div>


<h3><a id="sec-5_3_4" href="filling-in-the-layout#sec-pretty_rspec" class="heading"><span class="number">5.3.4</span> Приятный RSpec</a></h3>


<p>Мы отметили в <a class="ref" href="filling-in-the-layout#sec-route_tests">Разделе&nbsp;5.3.1</a> что тесты для статических страниц стали немного многословными и наполнились повторениями (<a class="ref" href="filling-in-the-layout#code-route_tests">Листинг&nbsp;5.20</a>). В этом разделе мы применим самые последние фишки RSpec для того чтобы сделать наши тесты более компактными и элегантными.</p>

<p>Давайте взглянем на пару примеров чтобы увидеть как они могут быть улучшены:</p>

<div class="code"><div class="highlight"><pre><span class="n">describe</span> <span class="s2">&quot;Home page&quot;</span> <span class="k">do</span>

  <span class="n">it</span> <span class="s2">&quot;should have the h1 &#39;Sample App&#39;&quot;</span> <span class="k">do</span>
    <span class="n">visit</span> <span class="n">root_path</span>
    <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">&#39;Sample App&#39;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">&quot;should have the base title&quot;</span> <span class="k">do</span>
    <span class="n">visit</span> <span class="n">root_path</span>
    <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span>
                      <span class="ss">text:</span> <span class="s2">&quot;Ruby on Rails Tutorial Sample App&quot;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">&quot;should not have a custom page title&quot;</span> <span class="k">do</span>
    <span class="n">visit</span> <span class="n">root_path</span>
    <span class="n">page</span><span class="o">.</span><span class="n">should_not</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">&#39;| Home&#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>


<p>Здесь стоит отметить одну вещь - все три примера включают посещение root_path. Мы можем устранить это дублирование с помощью блока <code>before</code>:</p>

<div class="code"><div class="highlight"><pre><span class="n">describe</span> <span class="s2">&quot;Home page&quot;</span> <span class="k">do</span>
  <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">root_path</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s2">&quot;should have the h1 &#39;Sample App&#39;&quot;</span> <span class="k">do</span>
    <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">&#39;Sample App&#39;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">&quot;should have the base title&quot;</span> <span class="k">do</span>
    <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span>
                      <span class="ss">text:</span> <span class="s2">&quot;Ruby on Rails Tutorial Sample App&quot;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">&quot;should not have a custom page title&quot;</span> <span class="k">do</span>
    <span class="n">page</span><span class="o">.</span><span class="n">should_not</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">&#39;| Home&#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>


<p>Здесь используется строка</p>

<div class="code"><div class="highlight"><pre><span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">root_path</span> <span class="p">}</span>
</pre></div>
</div>


<p>для того чтобы посещать root_path перед каждым примером. (Метод <code>before</code> можно также вызвать спомощью синонима <code>before(:each)</code>.)</p>

<p>Есть еще один источник повторений в каждом примере; у нас есть</p>

<div class="code"><div class="highlight"><pre><span class="n">it</span> <span class="s2">&quot;should have the h1 &#39;Sample App&#39;&quot;</span> <span class="k">do</span>
</pre></div>
</div>


<p>и</p>

<div class="code"><div class="highlight"><pre><span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">&#39;Sample App&#39;</span><span class="p">)</span>
</pre></div>
</div>


<p>которые, по сути, одно и то же. К тому же, оба примера ссылаются на переменную  <code>page</code>. Мы можем устранить это дублирование сказав  RSpec-y что <code>page</code> это <em>субъект</em> тестирования с помощью</p>

<div class="code"><div class="highlight"><pre><span class="n">subject</span> <span class="p">{</span> <span class="n">page</span> <span class="p">}</span>
</pre></div>
</div>


<p>а затем применив вариант метода <code>it</code> для того чтобы собрать код и описание (теста) в одну строку:</p>

<div class="code"><div class="highlight"><pre><span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">&#39;Sample App&#39;</span><span class="p">)</span> <span class="p">}</span>
</pre></div>
</div>


<p>Благодаря <code>subject { page }</code>, вызов <code>should</code> автоматически использует переменную <code>page</code> предоставленную гемом Capybara (<a class="ref" href="static-pages#sec-TDD">Раздел&nbsp;3.2.1</a>).</p>

<p>Применение этих изменений дает нам гораздо более компактные тесты для страницы Home:</p>

<div class="code"><div class="highlight"><pre>  <span class="n">subject</span> <span class="p">{</span> <span class="n">page</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s2">&quot;Home page&quot;</span> <span class="k">do</span>
    <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">root_path</span> <span class="p">}</span>

    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">&#39;Sample App&#39;</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span>
                        <span class="ss">text:</span> <span class="s2">&quot;Ruby on Rails Tutorial Sample App&quot;</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should_not</span> <span class="n">have_selector</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">&#39;| Home&#39;</span> <span class="p">}</span>
  <span class="k">end</span>
</pre></div>
</div>


<p>Этот код выглядит лучше, но тест заголовка по-прежнему длинноват. Кроме того, большая часть теста заголовка в <a class="ref" href="filling-in-the-layout#code-route_tests">Листинге&nbsp;5.20</a> содержит длиный текст заголовка вида</p>

<div class="code"><div class="highlight"><pre><span class="s2">&quot;Ruby on Rails Tutorial Sample App | About&quot;</span>
</pre></div>
</div>


<p>Упражнение в <a class="ref" href="static-pages#sec-static_pages_exercises">Разделе&nbsp;3.5</a> предлагает вам устранить часть этого дублирования посредством определения переменной <code>base_title</code> и интерполяции строк (<a class="ref" href="static-pages#code-pages_controller_spec_exercise">Листинг&nbsp;3.30</a>). Мы можем сделать еще лучше, определив <code>full_title</code>, который является параллелью хелпера <code>full_title</code> из <a class="ref" href="rails-flavored-ruby#code-title_helper">Листинга&nbsp;4.2</a>. Мы сделаем это создав директорию <code>spec/support</code> и файл <code>utilities.rb</code> для RSpec-утилит (<a class="ref" href="filling-in-the-layout#code-rspec_utilities">Листинг&nbsp;5.26</a>).</p>

<div class="label" id="code-rspec_utilities"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.26.</span> <span class="description">Файл для утилит RSpec с функцией <code>full_title</code>. <br /> <code>spec/support/utilities.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">full_title</span><span class="p">(</span><span class="n">page_title</span><span class="p">)</span>
  <span class="n">base_title</span> <span class="o">=</span> <span class="s2">&quot;Ruby on Rails Tutorial Sample App&quot;</span>
  <span class="k">if</span> <span class="n">page_title</span><span class="o">.</span><span class="n">empty?</span>
    <span class="n">base_title</span>
  <span class="k">else</span>
    <span class="s2">&quot;</span><span class="si">#{</span><span class="n">base_title</span><span class="si">}</span><span class="s2"> | </span><span class="si">#{</span><span class="n">page_title</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Конечно, это, по сути, дублирование хелпера из <a class="ref" href="rails-flavored-ruby#code-title_helper">Листинга&nbsp;4.2</a>, но наличие двух независимых методов позволит нам отловить возможные опечатки в базовом заголовке. Однако это все же довольно сомнительная реализация и лучший (немного более продвинутый) подход, который непосредственно тестирует оригинальный хелпер <code>full_title</code>, будет представлен в упражнениях (<a class="ref" href="filling-in-the-layout#sec-layout_exercises">Раздел&nbsp;5.6</a>).</p>

<p>Файлы в <code>spec/support</code> директории автоматически включаются RSpec, это означает что мы можем написать тесты для Home страницы следующим образом:</p>

<div class="code"><div class="highlight"><pre>  <span class="n">subject</span> <span class="p">{</span> <span class="n">page</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s2">&quot;Home page&quot;</span> <span class="k">do</span>
    <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">root_path</span> <span class="p">}</span>

    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span>    <span class="ss">text:</span> <span class="s1">&#39;Sample App&#39;</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="n">full_title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">))</span> <span class="p">}</span>
  <span class="k">end</span>
</pre></div>
</div>


<p>Теперь мы можем упростить тесты для страниц Help, About и Contact используя теже методы что и для страницы Home. Результаты представлены в <a class="ref" href="filling-in-the-layout#code-pretty_page_tests">Листинге&nbsp;5.27</a>.</p>

<div class="label" id="code-pretty_page_tests"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.27.</span> <span class="description">Улучшение тестов для статических страниц. <br /> <code>spec/requests/static_pages_spec.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="s2">&quot;Static pages&quot;</span> <span class="k">do</span>

  <span class="n">subject</span> <span class="p">{</span> <span class="n">page</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s2">&quot;Home page&quot;</span> <span class="k">do</span>
    <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">root_path</span> <span class="p">}</span>

    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span>    <span class="ss">text:</span> <span class="s1">&#39;Sample App&#39;</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="n">full_title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">))</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should_not</span> <span class="n">have_selector</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">&#39;| Home&#39;</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;Help page&quot;</span> <span class="k">do</span>
    <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">help_path</span> <span class="p">}</span>

    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span>    <span class="ss">text:</span> <span class="s1">&#39;Help&#39;</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="n">full_title</span><span class="p">(</span><span class="s1">&#39;Help&#39;</span><span class="p">))</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;About page&quot;</span> <span class="k">do</span>
    <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">about_path</span> <span class="p">}</span>

    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span>    <span class="ss">text:</span> <span class="s1">&#39;About&#39;</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="n">full_title</span><span class="p">(</span><span class="s1">&#39;About Us&#39;</span><span class="p">))</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;Contact page&quot;</span> <span class="k">do</span>
    <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">contact_path</span> <span class="p">}</span>

    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span>    <span class="ss">text:</span> <span class="s1">&#39;Contact&#39;</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="n">full_title</span><span class="p">(</span><span class="s1">&#39;Contact&#39;</span><span class="p">))</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Теперь необходимо убедиться что тесты по-прежнему проходят:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/static_pages_spec.rb
</pre></div>
</div>


<p>Стиль RSpec из <a class="ref" href="filling-in-the-layout#code-pretty_page_tests">Листинга&nbsp;5.27</a> намного более лаконичен нежели стиль в <a class="ref" href="filling-in-the-layout#code-route_tests">Листинге&nbsp;5.20</a>&mdash;однако, он может быть еще более лаконичным (<a class="ref" href="filling-in-the-layout#sec-layout_exercises">Раздел&nbsp;5.6</a>). При дальнейшей разработке примера приложения мы будем использовать этот более компактный стиль везде, где это только будет возможно.</p>

<div class="label" id="sec-user_signup"></div>


<h2><a id="sec-5_4" href="filling-in-the-layout#sec-user_signup" class="heading"><span class="number">5.4</span> Регистрация пользователей: первый шаг</a></h2>


<p>В качестве кульминации нашей работы над макетом и маршрутами, в этом разделе мы сделаем маршрут для страницы регистрации (signup), что будет означать создание второго контроллера. Это первый важный шаг к предоставлению пользователям возможности регистрироваться на нашем сайте, мы сделаем следующий шаг, моделирование пользователя, в <a class="ref" href="modeling-users#top">Главе&nbsp;6</a> и мы закончим работу в <a class="ref" href="sign-up#top">Главе&nbsp;7</a>.</p>

<div class="label" id="sec-users_controller"></div>


<h3><a id="sec-5_4_1" href="filling-in-the-layout#sec-users_controller" class="heading"><span class="number">5.4.1</span> Контроллер Users</a></h3>


<p>Мы создали наш первый контроллер  - StaticPages -  еще в <a class="ref" href="static-pages#sec-static_pages_with_rails">Разделе&nbsp;3.1.2</a>. Пришло время создать второй&nbsp;&mdash;&nbsp;контроллер Users.  Как и прежде, мы будем использовать <code>generate</code> для создания простейшего контроллера, который отвечает нашим текущим потребностям, а именно, с одной страницей-заглушкой для регистрации новых пользователей. Следуя конвенции <a  href="http://ru.wikipedia.org/wiki/REST">REST архитектуры</a> предпочитаемой Рельсами, мы назовем действие для новых пользователей, <code>new</code> и передадим его в качестве аргумента в <code>generate controller</code> для создания его (действия) автоматически (<a class="ref" href="filling-in-the-layout#code-generate_users_controller">Листинг&nbsp;5.28</a>).</p>

<div class="label" id="code-generate_users_controller"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.28.</span> <span class="description">Генерация контроллера Users (с <code>new</code> действием).</span> </div>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate controller Users new --no-test-framework
<span class="go">      create  app/controllers/users_controller.rb</span>
<span class="go">       route  get &quot;users/new&quot;</span>
<span class="go">      invoke  erb</span>
<span class="go">      create    app/views/users</span>
<span class="go">      create    app/views/users/new.html.erb</span>
<span class="go">      invoke  helper</span>
<span class="go">      create    app/helpers/users_helper.rb</span>
<span class="go">      invoke  assets</span>
<span class="go">      invoke    coffee</span>
<span class="go">      create      app/assets/javascripts/users.js.coffee</span>
<span class="go">      invoke    scss</span>
<span class="go">      create      app/assets/stylesheets/users.css.scss</span>
</pre></div>
</div></div>


<p>Это создает контроллер Users с <code>new</code> действием (<a class="ref" href="filling-in-the-layout#code-initial_users_controller">Листинг&nbsp;5.29</a>) и заглушку представления (<a class="ref" href="filling-in-the-layout#code-initial_new_action">Листинг&nbsp;5.30</a>).</p>

<div class="label" id="code-initial_users_controller"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.29.</span> <span class="description">Начальный контроллер Users с <code>new</code> действием. <br /> <code>app/controllers/users_controller.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">new</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code-initial_new_action"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.30.</span> <span class="description">Начальное <code>new</code> действие для Users. <br /> <code>app/views/users/new.html.erb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Users#new<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>Find me in app/views/users/new.html.erb<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>




<div class="label" id="sec-signup_url"></div>


<h3><a id="sec-5_4_2" href="filling-in-the-layout#sec-signup_url" class="heading"><span class="number">5.4.2</span> URI для регистрации</a></h3>


<p>С кодом из <a class="ref" href="filling-in-the-layout#sec-users_controller">Раздела&nbsp;5.4.1</a> у нас уже есть рабочая страница для создания новых пользователей на <tt>/users/new</tt>, но вспомним из <a class="ref" href="filling-in-the-layout#table-url_mapping">Таблицы&nbsp;5.1</a>, что вместо этого нам необходим URI <tt>/signup</tt>. Как и в <a class="ref" href="filling-in-the-layout#sec-layout_links">Разделе&nbsp;5.3</a>, мы начнем с написания интеграционных тестов, которые мы сейчас сгенерируем:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate integration_test user_pages
</pre></div>
</div>


<p>Затем, следуя модели спеков для статических страниц в <a class="ref" href="filling-in-the-layout#code-pretty_page_tests">Листинге&nbsp;5.27</a>, мы заполняем тесты для страниц пользователей кодом тестирующим содержимое <code>h1</code> и <code>title</code> тегов как это показано в <a class="ref" href="filling-in-the-layout#code-user_pages_spec">Листинге&nbsp;5.31</a>.</p>

<div class="label" id="code-user_pages_spec"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.31.</span> <span class="description">начальный спек для пользователей с тестом для страницы регистрации. <br /> <code>spec/requests/user_pages_spec.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="s2">&quot;User pages&quot;</span> <span class="k">do</span>

  <span class="n">subject</span> <span class="p">{</span> <span class="n">page</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s2">&quot;signup page&quot;</span> <span class="k">do</span>
    <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">signup_path</span> <span class="p">}</span>

    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span>    <span class="ss">text:</span> <span class="s1">&#39;Sign up&#39;</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="n">full_title</span><span class="p">(</span><span class="s1">&#39;Sign up&#39;</span><span class="p">))</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Мы можем запустить эти тесты командой <code>rspec</code> как обычно:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/user_pages_spec.rb
</pre></div>
</div>


<p>Стоит отметить что мы также можем запустить все интеграционные тесты передав в качестве параметра всю директорию вместо одного файла:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/
</pre></div>
</div>


<p>Опираясь на этот паттерн вы можете догадаться как запустить <em>все</em> спеки:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/
</pre></div>
</div>


<p>Обычно мы будем использовать именно этот способ запуска тестов в остальной части учебника. Кстати, стоит отметить, что вы можете также запускать набор тестов с помощью Rake задачи <code>spec</code>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rake spec
</pre></div>
</div>


<p>(Фактически, вы можете просто набрать <code>rake</code>; дефолтное поведение <code>rake</code> это запуск набора тестов.)</p>

<p>По конструкции, контроллер Users уже имеет <code>new</code> действие, так что все что нам необходимо для прохождения тестов это правильные маршрут и контент представления. Мы будем следовать примерам из  <a class="ref" href="filling-in-the-layout#code-static_page_routes">Листинга&nbsp;5.21</a> и добавим <code>match &rsquo;/signup&rsquo;</code> правило для URI регистрации (<a class="ref" href="filling-in-the-layout#code-signup_route">Листинг&nbsp;5.32</a>).</p>

<div class="label" id="code-signup_route"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.32.</span> <span class="description">Маршрут для страницы регистрации. <br /> <code>config/routes.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="ss">SampleApp::Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s2">&quot;users/new&quot;</span>

  <span class="n">root</span> <span class="ss">to:</span> <span class="s1">&#39;static_pages#home&#39;</span>

  <span class="n">match</span> <span class="s1">&#39;/signup&#39;</span><span class="p">,</span>  <span class="ss">to:</span> <span class="s1">&#39;users#new&#39;</span>

  <span class="n">match</span> <span class="s1">&#39;/help&#39;</span><span class="p">,</span>    <span class="ss">to:</span> <span class="s1">&#39;static_pages#help&#39;</span>
  <span class="n">match</span> <span class="s1">&#39;/about&#39;</span><span class="p">,</span>   <span class="ss">to:</span> <span class="s1">&#39;static_pages#about&#39;</span>
  <span class="n">match</span> <span class="s1">&#39;/contact&#39;</span><span class="p">,</span> <span class="ss">to:</span> <span class="s1">&#39;static_pages#contact&#39;</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Обратите внимание, мы сохранили правило  <code>get "users/new"</code>, которое было сгенерировано автоматически при создании Users контроллера в <a class="ref" href="filling-in-the-layout#code-generate_users_controller">Листинге&nbsp;5.28</a>. В настоящее время это правило необходимо для работы адреса <code>&rsquo;users/new&rsquo;</code>, но оно не соответствует REST конвенции (<a class="ref" href="a-demo-app#table-demo_RESTful_users">Таблица&nbsp;2.2</a>) и мы избавимся от него в <a class="ref" href="sign-up#sec-a_users_resource">Разделе&nbsp;7.1.2</a>.</p>

<p>Теперь все что нам теперь необходимо для прохождения тестов это представление с заголовком браузера и заголовком первого уровня &ldquo;Sign up&rdquo; (<a class="ref" href="filling-in-the-layout#code-initial_signup_page">Листинг&nbsp;5.33</a>).</p>

<div class="label" id="code-initial_signup_page"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.33.</span> <span class="description">Начальная страница регистрации (заглушка). <br /> <code>app/views/users/new.html.erb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="n">provide</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="s1">&#39;Sign up&#39;</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;h1&gt;</span>Sign up<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>Find me in app/views/users/new.html.erb<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>


<p>Теперь тест страницы регистрации из <a class="ref" href="filling-in-the-layout#code-user_pages_spec">Листинга&nbsp;5.31</a> должен пройти. Нам осталось лишь добавить соответствующую ссылку к кнопке на  Home странице. Как и с прочими маршрутами, <code>match &rsquo;/signup&rsquo;</code> дает нам именованный маршрут <code>signup_path</code>, который мы применяем в <a class="ref" href="filling-in-the-layout#code-home_page_signup_link">Листинге&nbsp;5.34</a>.</p>

<div class="label" id="code-home_page_signup_link"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.34.</span> <span class="description">Добавление ссылки к кнопке Signup. <br /> <code>app/views/static_pages/home.html.erb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;center hero-unit&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;h1&gt;</span>Welcome to the Sample App<span class="nt">&lt;/h1&gt;</span>

  <span class="nt">&lt;h2&gt;</span>
    This is the home page for the
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
    sample application.
  <span class="nt">&lt;/h2&gt;</span>

  <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Sign up now!&quot;</span><span class="p">,</span> <span class="n">signup_path</span><span class="p">,</span> <span class="ss">class:</span> <span class="s2">&quot;btn btn-large btn-primary&quot;</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">image_tag</span><span class="p">(</span><span class="s2">&quot;rails.png&quot;</span><span class="p">,</span> <span class="ss">alt:</span> <span class="s2">&quot;Rails&quot;</span><span class="p">),</span> <span class="s1">&#39;http://rubyonrails.org/&#39;</span> <span class="cp">%&gt;</span>
</pre></div>
</div></div>


<p>С этим работу над ссылками и именованными маршрутами можно считать законченной, по крайней мере до тех пор, пока мы не добавим маршрут для входа на сайт (<a class="ref" href="sign-in-sign-out#top">Глава&nbsp;8</a>). Получившаяся страница для регистрации пользователей (на URI <tt>/signup</tt>) представлена на <a class="ref" href="filling-in-the-layout#fig-new_signup_page">Рис.&nbsp;5.9</a>.</p>

<div class="label" id="fig-new_signup_page"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/new_signup_page_bootstrap.png" alt="new_signup_page_bootstrap" /></span></div><div class="caption"><span class="header">Рис. 5.9: </span><span class="description">Страница регистрации (<a href="http://localhost:3000/signup"><tt>/signup</tt></a>).&nbsp;<a href="http://railstutorial.org/images/figures/new_signup_page_bootstrap-full.png">(полный размер)</a></span></div></div>


<p>В этой точке тесты должны проходить:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/
</pre></div>
</div>




<div class="label" id="sec-layout_conclusion"></div>


<h2><a id="sec-5_5" href="filling-in-the-layout#sec-layout_conclusion" class="heading"><span class="number">5.5</span> Заключение</a></h2>


<p>В этой главе мы привели шаблон нашего приложение в чувство и отполировали маршруты. Остальная часть книги посвящена конкретизации примера приложения: во-первых, путем добавления пользователей, которые могут зарегистрироваться, войти в систему и выйти; затем добавлением пользовательских микросообщений и, наконец, добавлением возможности следить за микросообщениями других пользователей.</p>

<p>Если вы используете Git, вам следует объединить изменения с мастер-веткой:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git add .
<span class="gp">$</span> git commit -m <span class="s2">&quot;Finish layout and routes&quot;</span>
<span class="gp">$</span> git checkout master
<span class="gp">$</span> git merge filling-in-layout
</pre></div>
</div>


<p>Также вы можете отправить изменения на GitHub:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git push
</pre></div>
</div>


<p>Наконец, вы можете развернуть приложение на Heroku:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git push heroku
</pre></div>
</div>


<p>Результатом должно стать работающий пример приложения на продакшен сервере:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> heroku open
</pre></div>
</div>


<p>Если столкнулись с проблемами, попробуйте выполнить</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> heroku logs
</pre></div>
</div>


<p>чтобы узнать об ошибках с помощью логов Heroku.</p>

<div class="label" id="sec-layout_exercises"></div>


<h2><a id="sec-5_6" href="filling-in-the-layout#sec-layout_exercises" class="heading"><span class="number">5.6</span> Упражнения</a></h2>




<ol>

<li>Код для тестирования статических страниц в <a class="ref" href="filling-in-the-layout#code-pretty_page_tests">Листинге&nbsp;5.27</a> компактен, но по прежнему имеет повторения. RSpec поддерживает возможность называемую <em>shared examples</em> предназначенную для устранения такого вида дублирования. Следуя примеру в <a class="ref" href="filling-in-the-layout#code-static_pages_spec_shared_example">Листинге&nbsp;5.35</a>, заполните пропущенные тесты для страниц Help, About и Contact. Обратите внимание, что команда <code>let</code> кратко обсуждаемая в <a class="ref" href="static-pages#code-pages_controller_spec_exercise">Листинге&nbsp;3.30</a>, создает локальную переменную с данным значением по запросу (т.е. при использовании переменной), в отличие от переменной экземпляра, которая создается в момент назначения.</li>

<li>Возможно вы заметили что наши тесты для ссылок шаблона тестируют маршруты, но на самом деле не проверяют, ведут ли ссылки к правильным страницам. Один из способов реализации этих испытаний заключается в использовании <code>visit</code> и <code>click_link</code> внутри RSpec интеграционного теста. Дополните код из <a class="ref" href="filling-in-the-layout#code-layout_links_test">Листинга&nbsp;5.36</a> чтобы проверить что все ссылки шаблона правильно определены.</li>

<li>Устраните необходимость в тестовом хелпере <code>full_title</code> в <a class="ref" href="filling-in-the-layout#code-rspec_utilities">Листинге&nbsp;5.26</a> написав тест для оригинального вспомогательного метода, как это показано в <a class="ref" href="filling-in-the-layout#code-full_title_helper_tests">Листинге&nbsp;5.37</a>. (Вам необходимо будет создать директорию <code>spec/helpers</code> и файл <code>application_helper_spec.rb</code>.) Затем <code>include</code> его в тест с помощью кода в  <a class="ref" href="filling-in-the-layout#code-rspec_utilities_simplified">Листинге&nbsp;5.38</a>.  Проверьте запустив тесты, что новый код работает. <em>Примечание</em>: <a class="ref" href="filling-in-the-layout#code-full_title_helper_tests">Листинг&nbsp;5.37</a> использует <em>регулярные выражения</em>, о которых мы узнаем больше в  <a class="ref" href="modeling-users#sec-format_validation">Разделе&nbsp;6.2.4</a>. (Спасибо <a href="http://alexchaffee.com/">Alex Chaffee</a> за совет и код используемый в этом упражнении.)</li>

</ol>




<div class="label" id="code-static_pages_spec_shared_example"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.35.</span> <span class="description">Применение RSpec <em>shared example</em> для устранения дублирования в тестах. <br /> <code>spec/requests/static_pages_spec.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="s2">&quot;Static pages&quot;</span> <span class="k">do</span>

  <span class="n">subject</span> <span class="p">{</span> <span class="n">page</span> <span class="p">}</span>

  <span class="n">shared_examples_for</span> <span class="s2">&quot;all static pages&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span>    <span class="ss">text:</span> <span class="n">heading</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="n">full_title</span><span class="p">(</span><span class="n">page_title</span><span class="p">))</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;Home page&quot;</span> <span class="k">do</span>
    <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">root_path</span> <span class="p">}</span>
    <span class="n">let</span><span class="p">(</span><span class="ss">:heading</span><span class="p">)</span>    <span class="p">{</span> <span class="s1">&#39;Sample App&#39;</span> <span class="p">}</span>
    <span class="n">let</span><span class="p">(</span><span class="ss">:page_title</span><span class="p">)</span> <span class="p">{</span> <span class="s1">&#39;&#39;</span> <span class="p">}</span>

    <span class="n">it_should_behave_like</span> <span class="s2">&quot;all static pages&quot;</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should_not</span> <span class="n">have_selector</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">&#39;| Home&#39;</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;Help page&quot;</span> <span class="k">do</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;About page&quot;</span> <span class="k">do</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;Contact page&quot;</span> <span class="k">do</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code-layout_links_test"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.36.</span> <span class="description">Тест для ссылок в шаблоне. <br /> <code>spec/requests/static_pages_spec.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="s2">&quot;Static pages&quot;</span> <span class="k">do</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="n">it</span> <span class="s2">&quot;should have the right links on the layout&quot;</span> <span class="k">do</span>
    <span class="n">visit</span> <span class="n">root_path</span>
    <span class="n">click_link</span> <span class="s2">&quot;About&quot;</span>
    <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="n">full_title</span><span class="p">(</span><span class="s1">&#39;About Us&#39;</span><span class="p">)</span>
    <span class="n">click_link</span> <span class="s2">&quot;Help&quot;</span>
    <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="c1"># fill in</span>
    <span class="n">click_link</span> <span class="s2">&quot;Contact&quot;</span>
    <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="c1"># fill in</span>
    <span class="n">click_link</span> <span class="s2">&quot;Home&quot;</span>
    <span class="n">click_link</span> <span class="s2">&quot;Sign up now!&quot;</span>
    <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="c1"># fill in</span>
    <span class="n">click_link</span> <span class="s2">&quot;sample app&quot;</span>
    <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="c1"># fill in</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code-full_title_helper_tests"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.37.</span> <span class="description">Тесты для хелпера <code>full_title</code> из <code>application_helper.rb</code>. <br /> <code>spec/helpers/application_helper_spec.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="no">ApplicationHelper</span> <span class="k">do</span>

  <span class="n">describe</span> <span class="s2">&quot;full_title&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;should include the page title&quot;</span> <span class="k">do</span>
      <span class="n">full_title</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">=~</span> <span class="sr">/foo/</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should include the base title&quot;</span> <span class="k">do</span>
      <span class="n">full_title</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">=~</span> <span class="sr">/^Ruby on Rails Tutorial Sample App/</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should not include a bar for the home page&quot;</span> <span class="k">do</span>
      <span class="n">full_title</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">should_not</span> <span class="o">=~</span> <span class="sr">/\|/</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code-rspec_utilities_simplified"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 5.38.</span> <span class="description">Замена тестового хелпера <code>full_title</code> на простой <code>include</code>. <br /> <code>spec/support/utilities.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="kp">include</span> <span class="no">ApplicationHelper</span>
</pre></div>
</div></div>




<div class="navigation">  <a class="prev_page" href="rails-flavored-ruby#top">
    &laquo;&nbsp;<span class="number">Глава 4</span> Rails-приправленный Ruby
  </a>
  <a class="next_page" href="modeling-users#top">
    <span class="number">Глава 6</span> Моделирование пользователей&nbsp;&raquo;
  </a>
</div><div class="footnotes">
<ol>
<li id="fn-5_1">Спасибо читателю <a href="https://twitter.com/colmtuite#">Colm Tuite</a> за его замечательную работу по переводу примера приложения на CSS фреймворк Bootstrap.&nbsp;<a class="arrow" href="#fnref-5_1">&uarr;</a></li>
<li id="fn-5_2">Каркасы в <em>Ruby on Rails Tutorial</em> сделаны с помощью замечательного онлайн приложения для создания каркасов, называемого <a href="http://gomockingbird.com">Mockingbird</a>.&nbsp;<a class="arrow" href="#fnref-5_2">&uarr;</a></li>
<li id="fn-5_3">Они абсолютно не связаны с классами Ruby.&nbsp;<a class="arrow" href="#fnref-5_3">&uarr;</a></li>
<li id="fn-5_4">Вы моли заметить, что <code>img</code> tag, вместо сходства с <tt class="verb">&lt;img&gt;...&lt;/img&gt;</tt>, более похож на <tt class="verb">&lt;img ... /&gt;</tt>. Теги, соответствующие этой форме, известны как <em>самозакрывающиеся</em>.&nbsp;<a class="arrow" href="#fnref-5_4">&uarr;</a></li>
<li id="fn-5_5">Также возможно использовать LESS с файлопроводом; см. подробности на <a href="http://rubygems.org/gems/less-rails-bootstrap"><tt>GitHub странице гема less-rails-bootstrap</tt></a>.&nbsp;<a class="arrow" href="#fnref-5_5">&uarr;</a></li>
<li id="fn-5_6">Многие Rails разработчики используют <code>shared</code> директорию для партиалов совместно используемых разными представлениями. Я предпочитаю использовать <code>shared</code> папку для "служебных" партиалов которые используются во множестве страниц, помещая партиалы, которые используются буквально на каждой странице (такие как части шаблона сайта) в <code>layouts</code> директорию. (Мы создадим <code>shared</code> директорию в <a class="ref" href="sign-up#top">Главе&nbsp;7</a>.) Это кажется мне более логичным, но помещение всех партиалов в папку <code>shared</code> тоже замечательно работает.&nbsp;<a class="arrow" href="#fnref-5_6">&uarr;</a></li>
<li id="fn-5_7">Вы, возможно, удивлены тем, что мы используем и тег <code>footer</code> и класс <code>.footer</code>. Ответ заключается в том, что тег имеет понятное значение для читателя, а класс необходим для Bootstrap. Тег <code>div</code> вместо <code>footer</code> тоже будет работать.&nbsp;<a class="arrow" href="#fnref-5_7">&uarr;</a></li>
<li id="fn-5_8">Структура этого раздела опирается на замечательную статью <a href="http://2beards.net/2011/11/the-rails-3-asset-pipeline-in-about-5-minutes/">The Rails 3 Asset Pipeline in (about) 5 Minutes</a> от Michael Erasmus. Более подробно о файлопроводе см. <a href="http://rusrails.ru/asset-pipeline">(rus)Rails Guide on the Asset Pipeline</a>.&nbsp;<a class="arrow" href="#fnref-5_8">&uarr;</a></li>
<li id="fn-5_9">Более старый <code>.sass</code> формат, также поддерживаемый Sass, определяет новый язык который является менее многословным (и в нем нет фигурных скобок), но менее удобным для существующих проектов и его сложнее изучать тем кто уже знаком с CSS.&nbsp;<a class="arrow" href="#fnref-5_9">&uarr;</a></li>
</ol>
</div>
