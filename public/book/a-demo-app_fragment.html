<div id="top"></div>


<h1 class="chapter"><a id="sec-2" href="a-demo-app#top" class="heading"><span class="number">Глава 2</span> demo app</a></h1>


<p>В этой главе мы разработаем простое демонстрационное приложение, чтобы показать мощь Rails. Цель -  получить общее представление о программировании на Ruby on Rails (и веб-разработке в целом), быстро сгенерировав приложение, используя <em>scaffold generators</em>. Как обсуждалось в <a class="ref" href="beginning#sidebar-scaffolding">Блоке&nbsp;1.1</a>, остальная часть книги будет применять противоположный подход, постепенно разрабатывая приложение с объяснением всех новых понятий по мере их появления,  но для быстрого обзора (и некоторого быстрорастворимого удовлетворения) нет ничего лучше чем scaffolding. Конечное  демонстрационное приложение позволит нам взаимодействовать с ним через свои URI,, дав нам понимание структуры Rails приложений, включая первый пример <em>REST архитектуры</em> предпочитаемой Rails.</p>

<p>Как и предстоящий пример приложения, демонстрационное приложение будет состоять из <em>пользователей</em> и связанных с ними <em>микросообщений</em> (образуя минималистичное приложение в стиле Twitter). Функциональность будет совершенно слаборазвита и многие из шагов будут походить на волшебство, но не переживайте: полный пример приложения разработает подобное же приложение с нуля, начиная с <a class="ref" href="static-pages#top">Главы&nbsp;3</a>, и я дам многочисленные ссылки на более поздний материал. Тем временем, имейте терпение и немного веры - все таки основная цель данного учебника - удержать вас  <em>вне</em> этого поверхностного, управляемого scaffold подхода, для достижения более глубокого понимания Rails.</p>

<div class="label" id="sec-planning_the_application"></div>


<h2><a id="sec-2_1" href="a-demo-app#sec-planning_the_application" class="heading"><span class="number">2.1</span> Планирование приложения</a></h2>


<p>В этом Разделе мы обрисуем в общих чертах наши планы относительно демонстрационного приложения. Как и в <a class="ref" href="beginning#sec-the_first_application">Разделе&nbsp;1.2.3</a>, мы начнем с создания скелета приложения, используя команду <code>rails</code>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">cd</span> ~/rails_projects
<span class="gp">$</span> rails new demo_app
<span class="gp">$</span> <span class="nb">cd </span>demo_app
</pre></div>
</div>


<p>Затем, мы используем текстовый редактор, чтобы обновить <code>Gemfile</code> необходимый Bundler, содержанием из <a class="ref" href="a-demo-app#code-demo_gemfile_sqlite_version_redux">Листинга&nbsp;2.1</a>.</p>

<div class="label" id="code-demo_gemfile_sqlite_version_redux"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.1.</span> <span class="description"><code>Gemfile</code> для демонстрационного приложения.</span>
</div>
<div class="code"><div class="highlight"><pre><span class="n">source</span> <span class="s1">&#39;https://rubygems.org&#39;</span>

<span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.2.13&#39;</span>

<span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;sqlite3&#39;</span><span class="p">,</span> <span class="s1">&#39;1.3.5&#39;</span>
<span class="k">end</span>


<span class="c1"># Gems used only for assets and not required</span>
<span class="c1"># in production environments by default.</span>
<span class="n">group</span> <span class="ss">:assets</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;sass-rails&#39;</span><span class="p">,</span>   <span class="s1">&#39;3.2.5&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;coffee-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.2.2&#39;</span>

  <span class="n">gem</span> <span class="s1">&#39;uglifier&#39;</span><span class="p">,</span> <span class="s1">&#39;1.2.3&#39;</span>
<span class="k">end</span>

<span class="n">gem</span> <span class="s1">&#39;jquery-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;2.0.2&#39;</span>

<span class="n">group</span> <span class="ss">:production</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;pg&#39;</span><span class="p">,</span> <span class="s1">&#39;0.12.2&#39;</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Отмечу, что <a class="ref" href="a-demo-app#code-demo_gemfile_sqlite_version_redux">Листинг&nbsp;2.1</a> аналогичен <a class="ref" href="beginning#code-gemfile_pg_gem">Листингу&nbsp;1.9</a></p>

<p>Как и в <a class="ref" href="beginning#sec-heroku_setup">Разделе&nbsp;1.4.1</a>, мы установим локальные гемы и предотвратим установку production гемов с помощью опции <tt class="verb">--without production</tt>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle update
<span class="gp">$</span> bundle install --without production
</pre></div>
</div>


<p>Наконец, мы поместим наш код в систему контроля версий. Вспомним что <code>rails</code> команда генерирует дефолтный <code>.gitignore</code> файл, но, в зависимости от вашей системы, вы можете найти расширенный файл из <a class="ref" href="beginning#code-gitignore">Листинга&nbsp;1.7</a> гораздо более удобным. Затем инициализируем Git репозиторий и делаем первый коммит:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git init
<span class="gp">$</span> git add .
<span class="gp">$</span> git commit -m <span class="s2">&quot;Initial commit&quot;</span>
</pre></div>
</div>


<div class="label" id="fig-create_demo_repo"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/create_demo_repo.png" alt="create_demo_repo" /></span></div><div class="caption"><span class="header">Рисунок 2.1: </span><span class="description">Создание репозитория demo app на GitHub.&nbsp;<a href="http://railstutorial.org/images/figures/create_demo_repo-full.png">(полный размер)</a></span></div></div>


<p>Можно также дополнительно создать новый репозиторий (<a class="ref" href="a-demo-app#fig-create_demo_repo">Рис.&nbsp;2.1</a>) и отправить его на GitHub:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git remote add origin git@github.com:&lt;username&gt;/demo_app.git
<span class="gp">$</span> git push -u origin master
</pre></div>
</div>

<p>(Как и в случае с первым приложением, позаботьтесь о том чтобы <em>не</em> инициализировать  репозиторий GitHub с файлом <code>README</code>.)</p>

<p>Теперь мы готовы начать делать само приложение. Типичный первый шаг, при разработке приложений это создание <em>модели данных</em>, которая является изображением структур, необходимых нашему приложению. В нашем случае demo app будет упрощенным микроблогом: только пользователи и короткие (микро) сообщения. Таким образом, мы начнем с модели для <em>пользователей</em> приложения (<a class="ref" href="a-demo-app#sec-modeling_demo_users">Раздел&nbsp;2.1.1</a>), затем мы добавим модель для <em>микросообщений</em> (<a class="ref" href="a-demo-app#sec-modeling_demo_microposts">Раздел&nbsp;2.1.2</a>).</p>

<div class="label" id="sec-modeling_demo_users"></div>


<h3><a id="sec-2_1_1" href="a-demo-app#sec-modeling_demo_users" class="heading"><span class="number">2.1.1</span> Моделирование пользователей</a></h3>


<p>Вариантов для модели данных пользователя так же много, как много различных форм регистрации в сети; мы пойдем отчетливо минималистичным путем. У пользователей нашего demo app будет уникальный <code>целочисленный</code> идентификатор называемый <code>id</code>, публично видимое <code>имя </code> (тип - <code>string (строка)</code>), и <code>email</code> адрес  (также <code>string</code>) совпадающий с именем пользователя. Итоговая модель данных для пользователей представлена на <a class="ref" href="a-demo-app#fig-demo_user_model">Рис.&nbsp;2.2</a>.</p>

<div class="label" id="fig-demo_user_model"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_user_model.png" alt="demo_user_model" /></span></div><div class="caption"><span class="header">Рис. 2.2: </span><span class="description">Модель данных для пользователей.</span></div></div>


<p>Как мы увидим в <a class="ref" href="modeling-users#sec-database_migrations">Разделе&nbsp;6.1.1</a>, табличка <code>users</code> в <a class="ref" href="a-demo-app#fig-demo_user_model">Рис.&nbsp;2.2</a> соответствует <em>таблице</em> в базе данных и <code>id</code>, <code>name</code>, и <code>email</code> атрибуты это <em>столбцы</em> этой таблицы.</p>

<div class="label" id="sec-modeling_demo_microposts"></div>


<h3><a id="sec-2_1_2" href="a-demo-app#sec-modeling_demo_microposts" class="heading"><span class="number">2.1.2</span> Моделирование микросообщений</a></h3>


<p>Ядро модели данных микросообщений даже проще чем для пользователей: микросообщение имеет только <code>id</code> и поле <code>content</code> для текста микросообщения (тип- <code>string</code>).<sup class="footnote" id="fnref-2_1"><a href="#fn-2_1">1</a></sup> Есть дополнительная сложность: мы хотим <em>связать</em> каждое микросообщение с определенным пользователем; мы выполним это, записывая <code>user_id</code> владельца сообщения. Результаты показаны на <a class="ref" href="a-demo-app#fig-demo_micropost_model">Рис.&nbsp;2.3</a>.</p>

<div class="label" id="fig-demo_micropost_model"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_micropost_model.png" alt="demo_micropost_model" /></span></div><div class="caption"><span class="header">Рис. 2.3: </span><span class="description">Модель данных для микросообщений.</span></div></div>


<p>Мы увидим в <a class="ref" href="a-demo-app#sec-demo_user_has_many_microposts">Разделе&nbsp;2.3.3</a> (и более полно в <a class="ref" href="user-microposts#top">Главе&nbsp;10</a>) как этот <code>user_id</code> атрибут позволит нам кратко реализовать идею, что у пользователя потенциально есть много связанных с ним микросообщений.</p>

<div class="label" id="sec-demo_users_resource"></div>


<h2><a id="sec-2_2" href="a-demo-app#sec-demo_users_resource" class="heading"><span class="number">2.2</span> Ресурс Users</a></h2>


<p>В этом разделе мы реализуем модель данных пользователей из <a class="ref" href="a-demo-app#sec-modeling_demo_users">Раздела&nbsp;2.1.1</a>, наряду с веб-интерфейсом к этой модели. Эта комбинация образует <em>ресурс Users</em>, который позволит нам думать о пользователях как об объектах, которые могут быть созданы, считаны, обновлены, и удалены через сеть с использованием <a   href="http://ru.wikipedia.org/wiki/HTTP-протокол">HTTP протокола</a>. Как обещалось во введении, наш ресурс Users будет создаваться программой scaffold generator, которая стандартно поставляется с каждым проектом Rails. Я настоятельно прошу вас не всматриваться в генерируемый код; на этом этапе он лишь запутает вас.</p>

<p>Rails scaffolding запускается передачей <code>scaffold</code> команды скрипту <code>rails generate</code>. Аргумент команды <code>scaffold</code> это имя ресурса в единственном числе (в данном случае, <code>User</code>), вместе с дополнительными параметрами для атрибутов модели данных:<sup class="footnote" id="fnref-2_2"><a href="#fn-2_2">2</a></sup></p>

<div class="code"><div class="highlight"><pre>$ rails generate scaffold User name:string email:string
      invoke  active_record
      create    db/migrate/20111123225336_create_users.rb
      create    app/models/user.rb
      invoke    test_unit
      create      test/unit/user_test.rb
      create      test/fixtures/users.yml
       route  resources :users
      invoke  scaffold_controller
      create    app/controllers/users_controller.rb
      invoke    erb
      create      app/views/users
      create      app/views/users/index.html.erb
      create      app/views/users/edit.html.erb
      create      app/views/users/show.html.erb
      create      app/views/users/new.html.erb
      create      app/views/users/_form.html.erb
      invoke    test_unit
      create      test/functional/users_controller_test.rb
      invoke    helper
      create      app/helpers/users_helper.rb
      invoke      test_unit
      create        test/unit/helpers/users_helper_test.rb
      invoke  assets
      invoke    coffee
      create      app/assets/javascripts/users.js.coffee
      invoke    scss
      create      app/assets/stylesheets/users.css.scss
      invoke  scss
      create    app/assets/stylesheets/scaffolds.css.scss
</pre></div>
</div>


<p>Добавив <code>name:string</code> и <code>email:string</code>, мы добились того, что модель User приобрела форму соответствующую <a class="ref" href="a-demo-app#fig-demo_user_model">Рис.&nbsp;2.2</a>. (Отметьте, что нет надобности включать параметр для <code>id</code>; он создается Rails автоматически для использования в качестве <em>primary key</em> в базе данных.)</p>

<p>Чтобы продолжить с демонстрационным приложением, мы сначала должны <em>migrate (мигрировать, переместить)</em> базу данных, используя <em>Rake</em> (<a class="ref" href="a-demo-app#sidebar-rake">Блок&nbsp;2.1</a>):</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rake db:migrate
<span class="go">==  CreateUsers: migrating ====================================================</span>
<span class="go">-- create_table(:users)</span>
<span class="go">   -&gt; 0.0017s</span>
<span class="go">==  CreateUsers: migrated (0.0018s) ===========================================</span>
</pre></div>
</div>


<p>Это просто обновляет базу данных с нашей новой моделью данных <code>users</code>. (Мы узнаем больше о миграциях баз данных в <a class="ref" href="modeling-users#sec-database_migrations">Разделе&nbsp;6.1.1</a>.) Отметьте, что для того, чтобы обеспечить использование версии Rake, соответствующей нашему <code>Gemfile</code>, нам необходимо запустить <code>rake</code> используя <code>bundle exec</code>.</p>

<p>Теперь мы можем запустить локальный веб-сервер, используя <code>rails s</code>, что является сокращением для <code>rails server</code>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails s
</pre></div>
</div>


<p>При этом демонстрационное приложение уже должно быть готово по адресу <a href="http://localhost:3000/">http://localhost:3000/</a>.</p>

<div class="label" id="sidebar-rake"></div>


<div class="sidebar"><span class="title"><span class="header">Блок 2.1.</span><span class="description">Rake</span></span>
<p>В традиции Unix, <a  href="http://ru.wikipedia.org/wiki/Make"><em>make</em></a> утилита играет важную роль в сборке исполняемых программ из исходного кода; множество компьютерных хакеров зафиксировали в мышечной памяти строку</p>

<pre class="verbatim">  $ ./configure &amp;&amp; make &amp;&amp; sudo make install</pre>


<p>обычно используемую, для компиляции кода на Unix системах (включая Linux и Mac OS&nbsp;X).</p>

<p>Rake это <em>Ruby make</em>, make-подобный язык написанный на Ruby. Rails использует Rake, в значительной степени, специально для неисчислимых небольших административных задач, необходимых при разработке поддерживаемых базой данных веб-приложений. <code>rake db:migrate</code> команда, вероятно, наиболее распространена, но есть и многие другие; можно увидеть список задач базы данных, используя <code>-T db</code>:</p>

<pre class="verbatim">$ bundle exec rake -T db</pre>


<p>Чтобы увидеть все доступные Rake задачи, запустите</p>

<pre class="verbatim">$ bundle exec rake -T</pre>


<p>Список, вероятно, будет подавляющим, но не волнуйтесь, вы  не должны знать все (или даже большую часть) этих команд. К концу  <em>Учебника Rails</em>, вы  будете знать все самые важные.</p>
</div>


<div class="label" id="sec-a_user_tour"></div>


<h3><a id="sec-2_2_1" href="a-demo-app#sec-a_user_tour" class="heading"><span class="number">2.2.1</span> Обзор пользователя</a></h3>


<p>При посещении корневого url&nbsp;<a href="http://localhost:3000/">http://localhost:3000/</a> мы видим ту же самую дефолтную страницу Rails, что и на <a class="ref" href="beginning#fig-riding_rails_31">Рис.&nbsp;1.3</a>, но при генерировании ресурса Users scaffolding-ом мы также создали большое количество страниц для управления пользователями. Например, страницу для отображения списка всех пользователей на <a href="http://localhost:3000/users">/users</a> и страницу для создания нового пользователя на <a href="http://localhost:3000/">/users/new</a>. Остальная часть этого раздела, выделяется предпринятию ураганного тура через эти страницы пользователя. В процессе этого тура для вас может оказаться полезным иногда поглядывать на <a class="ref" href="a-demo-app#table-user_urls">Таблицу&nbsp;2.1</a>, которая показывает соответствие между страницами их URI.</p>

<div class="label" id="table-user_urls"></div>


<div class="table"><div class="center">
<table class="tabular"><tr><th class="align_left"><strong>URI</strong></th><th class="align_left"><strong>Действие</strong></th><th class="align_left"><strong>Назначение</strong></th></tr><tr class="top_bar"><td class="align_left"><a href="http://localhost:3000/users">/users</a></td><td class="align_left"><code>index</code></td><td class="align_left">страница, для отображения списка всех пользователей</td></tr><tr><td class="align_left"><a href="http://localhost:3000/users/1">/users/1</a></td><td class="align_left"><code>show</code></td><td class="align_left">страница показывающая пользователя с id <code>1</code></td></tr><tr><td class="align_left"><a href="http://localhost:3000/users/new">/users/new</a></td><td class="align_left"><code>new</code></td><td class="align_left">страница для создания нового пользователя</td></tr><tr><td class="align_left"><a href="http://localhost:3000/users/1/edit">/users/1/edit</a></td><td class="align_left"><code>edit</code></td><td class="align_left">страница для редактирования пользователя с id <code>1</code></td></tr></table></div><div class="caption"><span class="header">Таблица 2.1: </span><span class="description">Cоответствие между страницами и URI для ресурса Users.</span></div></div>


<p>Мы начнем со страницы показывающей всех пользователей в нашем приложении, называемой <a href="http://localhost:3000/users"><tt>index</tt></a>; как вы могли бы ожидать, изначально там нет никаких пользователей (<a class="ref" href="a-demo-app#fig-demo_blank_user_index_rails_3">Рис.&nbsp;2.4</a>).</p>

<div class="label" id="fig-demo_blank_user_index_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_blank_user_index_rails_3.png" alt="demo_blank_user_index_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.4: </span><span class="description">Начальная index страница для ресурса Users (<a href="http://localhost:3000/users">/users</a>).&nbsp;<a href="/images/figures/demo_blank_user_index_rails_3-full.png#">(полный размер)</a></span></div></div>


<p>Для того, чтобы создать нового пользователя мы посещаем<a href="http://localhost:3000/users/new"><tt>new</tt></a> страницу, как показано на <a class="ref" href="a-demo-app#fig-demo_new_user_rails_3">Рис.&nbsp;2.5</a>. (Поскольку http://localhost:3000 часть адреса явно будет повторятся до тех пор пока мы разрабатываем локально, я буду обычно опускать ее с этого момента.) В <a class="ref" href="sign-up#top">Главе&nbsp;7</a> это станет страницей регистрации пользователя.</p>

<div class="label" id="fig-demo_new_user_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_new_user_rails_3.png" alt="demo_new_user_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.5: </span><span class="description">Страница создания нового пользователя (<a href="http://localhost:3000/users/new">/users/new</a>).&nbsp;<a href="/images/figures/demo_new_user_rails_3-full.png#">(полный размер)</a></span></div></div>


<p>Мы можем создать пользователя, введя значения имени и адреса электронной почты в текстовые поля и нажав затем кнопку Create User. Результат - страница <a href="http://localhost:3000/users/1"><tt>show</tt></a> как видно на <a class="ref" href="a-demo-app#fig-demo_show_user_rails_3">Рис.&nbsp;2.6</a>. (Зеленое приглашающее сообщение выполняется с использованием <em>флэш</em>, о котором мы узнаем в <a class="ref" href="sign-up#sec-the_flash">Разделе&nbsp;7.4.2</a>.) Отметим, что в URI <a href="http://localhost:3000/users/1">/users/1</a>;  как вы  могли бы подозревать, цифра&nbsp;<code>1</code> это просто атрибут&nbsp;<code>id</code> пользователя из <a class="ref" href="a-demo-app#fig-demo_user_model">Рис.&nbsp;2.2</a>. В <a class="ref" href="sign-up#sec-showing_users">Разделе&nbsp;7.1</a>эта страница станет профилем пользователя.</p>

<div class="label" id="fig-demo_show_user_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_show_user_rails_3.png" alt="demo_show_user_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.6: </span><span class="description">Страница показывающая пользователя (<a href="http://localhost:3000/users/1">/users/1</a>).&nbsp;<a href="/images/figures/demo_show_user_rails_3-full.png#">(полный размер)</a></span></div></div>


<p>Для того, чтобы изменить информацию пользователя, мы посещаем страницу <a href="http://localhost:3000/users/1/edit"><tt>edit</tt></a> (<a class="ref" href="a-demo-app#fig-demo_edit_user_rails_3">Рис.&nbsp;2.7</a>). Изменяя информацию о пользователе и нажимая кнопку Update User, мы изменяем информацию о пользователя в демонстрационном приложении (<a class="ref" href="a-demo-app#fig-demo_update_user_rails_3">Рис.&nbsp;2.8</a>). (Как мы увидим в <a class="ref" href="modeling-users#top">Главе&nbsp;6</a>, эти данные пользователя хранятся в бэкэнде базы данных.) Мы добавим функции edit/update (редактировать/обновить) пользователя к примеру приложения в <a class="ref" href="updating-showing-and-deleting-users#sec-updating_users">Разделе&nbsp;9.1</a>.</p>

<div class="label" id="fig-demo_edit_user_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_edit_user_rails_3.png" alt="demo_edit_user_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.7: </span><span class="description">Страница  редактирования пользователя (<a href="http://localhost:3000/users/1/edit">/users/1/edit</a>).&nbsp;<a href="/images/figures/demo_edit_user_rails_3-full.png#">(полный размер)</a></span></div></div>




<div class="label" id="fig-demo_update_user_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_update_user_rails_3.png" alt="demo_update_user_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.8: </span><span class="description">Пользователь с обновленной информацией.&nbsp;<a href="/images/figures/demo_update_user_rails_3-full.png#">(полный размер)</a></span></div></div>


<p>Теперь мы создадим второго пользователя, повторно посетив <a href="http://localhost:3000/users/new"><tt>new</tt></a> страницу и предоставив второй набор информации о пользователе; получившаяся страница <a href="http://localhost:3000/users"><tt>index</tt></a> показана на <a class="ref" href="a-demo-app#fig-demo_user_index_two_rails_3">Рис.&nbsp;2.9</a>. <a class="ref" href="sign-up#sec-showing_users">Раздел&nbsp;7.1</a> преобразует список пользователей в более отполированную страницу для демонстрации всех пользователей.</p>

<div class="label" id="fig-demo_user_index_two_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_user_index_two_rails_3.png" alt="demo_user_index_two_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.9: </span><span class="description">Страница-список пользователей (<a href="http://localhost:3000/users">/users</a>) с вторым пользователем.&nbsp;<a href="/images/figures/demo_user_index_two_rails_3-full.png#">(полный размер)</a></span></div></div>


<p>Показав как создавать, отображать и редактировать пользователей, мы переходим, наконец, к их уничтожению (<a class="ref" href="a-demo-app#fig-demo_destroy_user_rails_3">Рис.&nbsp;2.10</a>). Следует проверить, что клик по ссылке показанной на <a class="ref" href="a-demo-app#fig-demo_destroy_user_rails_3">Рис.&nbsp;2.10</a> уничтожает второго пользователя, приводя к index странице с одним пользователем. (Если это не работает, убедитесь, что JavaScript включен в вашем браузере; Rails использует JavaScript, чтобы выдать запрос, который должен уничтожить пользователя.) <a class="ref" href="updating-showing-and-deleting-users#sec-destroying_users">Раздел&nbsp;9.4</a> добавляет удаление пользователя к демонстрационному приложению, заботясь об ограничении его использования специальным классом административных пользователей.</p>

<div class="label" id="fig-demo_destroy_user_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_destroy_user_rails_3.png" alt="demo_destroy_user_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.10: </span><span class="description">Уничтожение пользователя.&nbsp;<a href="/images/figures/demo_destroy_user_rails_3-full.png#">(полный размер)</a></span></div></div>




<div class="label" id="sec-mvc_in_action"></div>


<h3><a id="sec-2_2_2" href="a-demo-app#sec-mvc_in_action" class="heading"><span class="number">2.2.2</span> MVC в действии</a></h3>


<p>Теперь, когда мы завершили быстрый обзор ресурса Пользователи (Users), давайте исследуем одну его определенную часть в контексте паттерна Модель-Представление-Контроллер (MVC) частично представленного в  <a class="ref" href="beginning#sec-mvc">Разделе&nbsp;1.2.6</a>. Наша стратегия будет состоять в том, чтобы описать результаты типичного запроса браузера: посещение index страницы пользователя на <a href="http://localhost:3000/users">/users</a>&mdash;в терминах MVC (<a class="ref" href="a-demo-app#fig-mvc_detailed">Рис.&nbsp;2.11</a>).</p>

<div class="label" id="fig-mvc_detailed"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/mvc_detailed.png" alt="mvc_detailed" /></span></div><div class="caption"><span class="header">Рис. 2.11: </span><span class="description">Подробная схема MVC в Rails.&nbsp;<a href="/images/figures/mvc_detailed-full.png#">(полный размер)</a></span></div></div>




<ol>
<li>Браузер выдает запрос на URI /users.</li>
<li>Rails направляет <tt>/users</tt> к <code>index</code> действию в контроллере Users.</li>
<li><code>Index</code> действие просит, чтобы модель User получила всех пользователей (<code>User.all</code>).</li>
<li>Модель User вытягивает всех пользователей из базы данных.</li>
<li>Модель User возвращает список пользователей в контроллер.</li>
<li>Контроллер получает пользователей в <code>@users</code> переменной, которую он передает <code>index</code> представлению.</li>
<li>Представление использует Embedded (Встроенный) Ruby, чтобы визуализировать страницу как HTML.</li>
<li>Контроллер возвращает HTML в браузер.<sup class="footnote" id="fnref-2_3"><a href="#fn-2_3">3</a></sup></li>
</ol>


<p>Мы начинаем с запроса, выданного браузером &mdash; то есть, с результата ввода URI в адресной строке или клика по ссылке (Шаг&nbsp;1 в <a class="ref" href="a-demo-app#fig-mvc_detailed">Рис.&nbsp;2.11</a>). Этот запрос вызывает <em>Rails маршрутизатор</em> (Шаг&nbsp;2), который отправляет к  надлежащему, <em>действию контроллера</em>, основываясь на URI (и, как мы увидим в <a class="ref" href="static-pages#sidebar-get_etc">Блоке&nbsp;3.1</a>, на типе запроса). Код создающий перенаправление URI пользователя к действиям контроллера для ресурса Users представлен в <a class="ref" href="a-demo-app#code-rails_routes">Листинге&nbsp;2.2</a>; этот код  фактически устанавливает таблицу пар URI/Действие, которые мы видели в <a class="ref" href="a-demo-app#table-user_urls">Таблице&nbsp;2.1</a>. (Странная нотация <code>:users</code> это <em>symbol</em>, о котором мы узнаем в <a class="ref" href="rails-flavored-ruby#sec-hashes_and_symbols">Разделе&nbsp;4.3.3</a>.)</p>

<div class="label" id="code-rails_routes"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.2.</span> <span class="description">Маршруты Rails, с правилом для ресурса Users. <br /> <code>config/routes.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="ss">DemoApp::Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:users</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Страницы из <a class="ref" href="a-demo-app#sec-a_user_tour">Раздела&nbsp;2.2.1</a> соответствуют <em>действиям</em> в <em>контроллере</em> Users, который является набором связанных действий; контроллер, сгенерированный scaffolding, схематично показан в <a class="ref" href="a-demo-app#code-demo_users_controller">Листинге&nbsp;2.3</a>. Отметьте запись <code>class UsersController &lt; ApplicationController</code>; это  пример Ruby <em>класса</em> с <em>наследованием</em>. (Мы  вкратце обсудим наследование в <a class="ref" href="a-demo-app#sec-inheritance_hierarchies">Разделе&nbsp;2.3.4</a> и раскроем обе темы более подробно в <a class="ref" href="rails-flavored-ruby#sec-ruby_classes">Разделе&nbsp;4.4</a>.)</p>

<div class="label" id="code-demo_users_controller"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.3.</span> <span class="description">Контроллер Users в схематичной форме. <br /> <code>app/controllers/users_controller.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">edit</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Вы могли заметить, что действий больше чем страниц; <code>index</code>, <code>show</code>, <code>new</code>, и <code>edit</code> действия - все они соответствуют страницам из <a class="ref" href="a-demo-app#sec-a_user_tour">Раздела&nbsp;2.2.1</a>, но есть также дополнительные <code>create</code> (создать), <code>update</code> (обновить), и <code>destroy</code> (разрушить) действия. Эти действия обычно не визуализируют страниц (хотя иногда могут); вместо этого, их основная цель состоит в том, чтобы изменять информацию о пользователях в базе данных. Этот полный комплект действий контроллера, сведенный в <a class="ref" href="a-demo-app#table-demo_RESTful_users">Таблицу&nbsp;2.2</a>, представляет реализацию архитектуры REST в Rails (<a class="ref" href="a-demo-app#sidebar-REST">Блок&nbsp;2.2</a>), которая опирается на идеи <em>передачи состояния представления</em> идентифицированные и названые ученым <a href="http://en.wikipedia.org/wiki/Roy_Fielding">Roy Fielding</a>.<sup class="footnote" id="fnref-2_4"><a href="#fn-2_4">4</a></sup> Отметьте в <a class="ref" href="a-demo-app#table-demo_RESTful_users">Таблице&nbsp;2.2</a> что есть некоторое наложение в URIs; например, и <code>show</code> и <code>update</code> действиям соответствует URI /users/1. Различие между ними в <a  href="http://ru.wikipedia.org/wiki/HTTP#.D0.9C.D0.B5.D1.82.D0.BE.D0.B4.D1.8B">методе запроса HTTP</a> на который они отвечают. Мы узнаем больше о методах запроса HTTP в <a class="ref" href="static-pages#sec-TDD">Разделе&nbsp;3.2.1</a>.</p>

<div class="label" id="table-demo_RESTful_users"></div>


<div class="table"><div class="center">
<table class="tabular"><tr><th class="align_left"><strong>HTTP запрос</strong></th><th class="align_left"><strong>URI</strong></th><th class="align_left"><strong>Действие</strong></th><th class="align_left"><strong>Назначение</strong></th></tr><tr class="top_bar"><td class="align_left"><tt>GET</tt></td><td class="align_left">/users</td><td class="align_left"><code>index</code></td><td class="align_left">страница со списком всех пользователей</td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left">/users/1</td><td class="align_left"><code>show</code></td><td class="align_left">страница показывающая пользователя с id <code>1</code></td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left">/users/new</td><td class="align_left"><code>new</code></td><td class="align_left">страница для создания нового пользователя</td></tr><tr><td class="align_left"><tt>POST</tt></td><td class="align_left">/users</td><td class="align_left"><code>create</code></td><td class="align_left">создание нового пользователя</td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left">/users/1/edit</td><td class="align_left"><code>edit</code></td><td class="align_left">страница для редактирования пользователя с id <code>1</code></td></tr><tr><td class="align_left"><tt>PUT</tt></td><td class="align_left">/users/1</td><td class="align_left"><code>update</code></td><td class="align_left">обновление пользователя с id <code>1</code></td></tr><tr><td class="align_left"><tt>DELETE</tt></td><td class="align_left">/users/1</td><td class="align_left"><code>destroy</code></td><td class="align_left">удаление пользователя с id <code>1</code></td></tr></table></div><div class="caption"><span class="header">Таблица 2.2: </span><span class="description">RESTful маршруты предоставленные ресурсом Users в <a class="ref" href="a-demo-app#code-rails_routes">Листинге&nbsp;2.2</a>.</span></div></div>




<div class="label" id="sidebar-REST"></div>


<div class="sidebar"><span class="title"><span class="header">Блок 2.2.</span><span class="description">REpresentational State Transfer (REST, </a href="http://ru.wikipedia.org/wiki/REST">«передача состояния представления»</a>)</span></span>
<p>Если вы  много читали о веб-разработке на Ruby on Rails, вы  видели много ссылок на &ldquo;REST&rdquo;, являющуюся акронимом для REpresentational State Transfer («передача состояния представления»). REST - архитектурный стиль для разработки распределенных, сетевых систем и приложений, таких как World Wide Web и веб-приложения. Хотя теория REST довольно абстрактна, в контексте Rails приложений REST означает, что большинство компонентов приложения (таких как пользователи и микросообщения) моделируются как <em>ресурсы</em>, которые могут быть созданы (Сreated), прочитаны (Read), обновлены (Updated), и удалены (Deleted) - операции, которые соответствуют и <a href="http://ru.wikipedia.org/wiki/CRUD">операциям CRUD, реляционных баз данных</a> и четырем фундаментальным <a href="http://ru.wikipedia.org/wiki/HTTP#.D0.9C.D0.B5.D1.82.D0.BE.D0.B4.D1.8B">методам запроса HTTP</a>: <tt>POST</tt>, <tt>GET</tt>, <tt>PUT</tt>, и <tt>DELETE</tt>. (Мы узнаем больше о запросах HTTP в <a class="ref" href="static-pages#sec-TDD">Разделе&nbsp;3.2.1</a> и особенно в <a class="ref" href="static-pages#sidebar-get_etc">Блоке&nbsp;3.1</a>.)</p>

<p>Как разработчику Rails приложений, RESTful стиль разработки помогает вам определиться какие контроллеры и действия писать: вы  просто структурируете приложение, используя ресурсы, которые создаются, читаются, обновляются, и удаляются. В случае пользователей и микросообщений, этот процесс является простым, так как они - натуральные ресурсы по определению. В <a class="ref" href="following-users#top">Главе&nbsp;11</a>мы увидим пример, где принципы REST позволяют нам моделировать более тонкую проблему &ldquo;Слежения за сообщениями пользователей&rdquo; естественным и удобным способом.</p>
</div>


<p>Чтобы исследовать отношения между контроллером Users и моделью User, давайте сосредоточимся на упрощенной версии <code>index</code> действия, показанной в <a class="ref" href="a-demo-app#code-demo_index_action">Листинге&nbsp;2.4</a>. (Код scaffold уродливый и запутанный, так что я опустил большую его часть.)</p>

<div class="label" id="code-demo_index_action"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.4.</span> <span class="description">Упрощенное index  действие для демонстрационного приложения. <br /> <code>app/controllers/users_controller.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@users</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">all</span>
  <span class="k">end</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>У этого <code>index</code> действия есть строка <code>@users = User.all</code> (Шаг&nbsp;3), которая просит, чтобы модель User получила список всех пользователей из базы данных (Шаг&nbsp;4), и затем помещает их в переменную  <code>@users</code> (произносится &ldquo;at-users&rdquo;) (Шаг&nbsp;5). Сама модель User появляется в <a class="ref" href="a-demo-app#code-demo_user_model">Листинге&nbsp;2.5</a>; хотя она довольно проста, к ней прилагается большое количество функций из-за наследования (<a class="ref" href="a-demo-app#sec-inheritance_hierarchies">Раздел&nbsp;2.3.4</a> и <a class="ref" href="rails-flavored-ruby#sec-ruby_classes">Раздел&nbsp;4.4</a>). В частности, за счет использования Rails библиотеки <em>Active Record</em>,  код в <a class="ref" href="a-demo-app#code-demo_user_model">Листинге&nbsp;2.5</a> заставляет <code>User.all</code> возвратить всех пользователей. (Мы узнаем о строке <code>attr_accessible</code> в <a class="ref" href="modeling-users#sec-accessible_attributes">Разделе&nbsp;6.1.2.2</a>. <em>Примечание</em>: Эта строка не появляется если вы ипользуете Rails&nbsp;3.2.2 или более старые версии.)</p>

<div class="label" id="code-demo_user_model"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.5.</span> <span class="description">Модель User для демонстрационного приложения. <br /> <code>app/models/user.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord::Base</span>
  <span class="n">attr_accessible</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:name</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Как только <code>@users</code> переменная определена, контроллер вызывает <em>представление </em> (Шаг&nbsp;6), показанное в <a class="ref" href="a-demo-app#code-demo_index_view">Листинге&nbsp;2.6</a>. Переменные, которые начинаются со знака <code>@</code>, называемые <em>переменными экземпляра</em>, автоматически доступны в представлении; в данном случае, представление <code>index.html.erb</code> в <a class="ref" href="a-demo-app#code-demo_index_view">Листинге&nbsp;2.6</a> перебирает  список <code>@users</code> и выводит строку HTML для каждого. (Помните, вы не должны пытаться понять этот код прямо сейчас. Он показан только для иллюстрации.)</p>

<div class="label" id="code-demo_index_view"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.6.</span> <span class="description">Представление для index. <br /> <code>app/views/users/index.html.erb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Listing users<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;table&gt;</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;th&gt;</span>Name<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;</span>Email<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;&lt;/th&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>

<span class="cp">&lt;%</span> <span class="vi">@users</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">user</span><span class="o">.</span><span class="n">name</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;Show&#39;</span><span class="p">,</span> <span class="n">user</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;Edit&#39;</span><span class="p">,</span> <span class="n">edit_user_path</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;Destroy&#39;</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="nb">method</span><span class="p">:</span> <span class="ss">:delete</span><span class="p">,</span>
                                     <span class="ss">data:</span> <span class="p">{</span> <span class="ss">confirm:</span> <span class="s1">&#39;Are you sure?&#39;</span> <span class="p">}</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/table&gt;</span>

<span class="nt">&lt;br</span> <span class="nt">/&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;New User&#39;</span><span class="p">,</span> <span class="n">new_user_path</span> <span class="cp">%&gt;</span>
</pre></div>
</div></div>


<p>Представление преобразует свое содержимое в HТML (Шаг&nbsp;7), который затем возвращается контроллером в браузер для отображения (Шаг&nbsp;8).</p>

<div class="label" id="sec-weaknesses_of_this_users_resource"></div>


<h3><a id="sec-2_2_3" href="a-demo-app#sec-weaknesses_of_this_users_resource" class="heading"><span class="number">2.2.3</span> Недостатки данного Users ресурса</a></h3>


<p>Несмотря на полезность для общего обзора Rails, scaffold-ный ресурс Users имеет много серьезных недостатков.</p>

<ul>
<li><strong>Нет валидации данных.</strong> Наша модель User  безропотно принимает такие данные как пустые имена и недопустимые адреса электронной почты.</li>
<li><strong>Нет аутентификации.</strong> У нас нет понятия регистрации, и нет способа воспрепятствовать тому, чтобы любой пользователь выполнил любую операцию.</li>
<li><strong>Нет тестов.</strong> Что, технически, не вполне верно &mdash; scaffolding включает рудиментарные тесты &mdash; но сгенерированные тесты уродливы и негибки, и они не тестируют на подтверждение правильности данных, аутентификацию, или какие нибудь другие пользовательские потребности.</li>
<li><strong>Нет макета.</strong> Нет сколь-нибудь связанного стиля сайта или навигации.</li>
<li><strong>Нет реального понимания.</strong> Если вы понимаете код scaffold-а, вам, вероятно, не стОит читать эту книгу.</li>
</ul>




<div class="label" id="sec-microposts_resource"></div>


<h2><a id="sec-2_3" href="a-demo-app#sec-microposts_resource" class="heading"><span class="number">2.3</span> Ресурс Microposts</a></h2>


<p>Сгенерировав и исследовав ресурс Users, мы поворачиваемся теперь к связанному с ним ресурсу Microposts. На протяжении этого раздела я рекомендую сравнивать элементы ресурса Microposts с аналогичными элементами User из <a class="ref" href="a-demo-app#sec-demo_users_resource">Раздела&nbsp;2.2</a>; вы должны увидеть, что эти два ресурса во многом параллельны друг другу. RESTful структура Rails приложений лучше всего усваивается посредством наблюдения за подобными повторяющимися формами; действительно, наблюдение параллельной структуры Users и Microposts даже на этой ранней стадии является одной из причин написания этой главы. (Как мы увидим, написание приложения, более устойчивого, нежели игрушечный пример в этой главе, требует значительных усилий &mdash; мы не увидим ресурс Microposts до <a class="ref" href="user-microposts#top">Главы&nbsp;10</a> &mdash; и я не хотел так надолго откладывать его первое появление.)</p>

<div class="label" id="sec-a_micropost_microtour"></div>


<h3><a id="sec-2_3_1" href="a-demo-app#sec-a_micropost_microtour" class="heading"><span class="number">2.3.1</span> Микрообзор микросообщений</a></h3>


<p>Как и с ресурсом Users, мы генерируем код scaffold для ресурса Microposts, используя <code>rails generate scaffold</code>, в этом случае реализуя модель данных из <a class="ref" href="a-demo-app#fig-demo_micropost_model">Рис.&nbsp;2.3</a>:<sup class="footnote" id="fnref-2_5"><a href="#fn-2_5">5</a></sup></p>

<div class="code"><div class="highlight"><pre>$ rails generate scaffold Micropost content:string user_id:integer
      invoke  active_record
      create    db/migrate/20111123225811_create_microposts.rb
      create    app/models/micropost.rb
      invoke    test_unit
      create      test/unit/micropost_test.rb
      create      test/fixtures/microposts.yml
       route  resources :microposts
      invoke  scaffold_controller
      create    app/controllers/microposts_controller.rb
      invoke    erb
      create      app/views/microposts
      create      app/views/microposts/index.html.erb
      create      app/views/microposts/edit.html.erb
      create      app/views/microposts/show.html.erb
      create      app/views/microposts/new.html.erb
      create      app/views/microposts/_form.html.erb
      invoke    test_unit
      create      test/functional/microposts_controller_test.rb
      invoke    helper
      create      app/helpers/microposts_helper.rb
      invoke      test_unit
      create        test/unit/helpers/microposts_helper_test.rb
      invoke  assets
      invoke    coffee
      create      app/assets/javascripts/microposts.js.coffee
      invoke    scss
      create      app/assets/stylesheets/microposts.css.scss
      invoke  scss
   identical    app/assets/stylesheets/scaffolds.css.scss
</pre></div>
</div>


<p>чтобы обновить нашу базу данных с новой моделью данных, мы должны запустить миграцию как в <a class="ref" href="a-demo-app#sec-demo_users_resource">Разделе&nbsp;2.2</a>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rake db:migrate
<span class="go">==  CreateMicroposts: migrating ===============================================</span>
<span class="go">-- create_table(:microposts)</span>
<span class="go">   -&gt; 0.0023s</span>
<span class="go">==  CreateMicroposts: migrated (0.0026s) ======================================</span>
</pre></div>
</div>


<p>Теперь мы имеем возможность создавать микропосты тем же образом, каким мы создавали пользователей в <a class="ref" href="a-demo-app#sec-a_user_tour">Разделе&nbsp;2.2.1</a>. Как вы могли бы предположить, генератор scaffold добавил в файл маршрутов Rails правило для ресурса Microposts, как видно в <a class="ref" href="a-demo-app#code-demo_microposts_resource">Листинге&nbsp;2.7</a>.<sup class="footnote" id="fnref-2_6"><a href="#fn-2_6">6</a></sup> Как и с users, <code>resources :microposts</code> маршрутное правило направляет  URL микросообщений на действия в контроллере Microposts, как видно в <a class="ref" href="a-demo-app#table-demo_RESTful_microposts">Таблице&nbsp;2.3</a>.</p>

<div class="label" id="code-demo_microposts_resource"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.7.</span> <span class="description">Маршруты Rails с новым правилом для ресурсов Microposts. <br /> <code>config/routes.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="ss">DemoApp::Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:microposts</span>
  <span class="n">resources</span> <span class="ss">:users</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="table-demo_RESTful_microposts"></div>


<div class="table"><div class="center">
<table class="tabular"><tr><th class="align_left"><strong>HTTP запрос</strong></th><th class="align_left"><strong>URI</strong></th><th class="align_left"><strong>Действие</strong></th><th class="align_left"><strong>Назначение</strong></th></tr><tr class="top_bar"><td class="align_left"><tt>GET</tt></td><td class="align_left">/microposts</td><td class="align_left"><code>index</code></td><td class="align_left">страница со списком всех микросообщений</td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left">/microposts/1</td><td class="align_left"><code>show</code></td><td class="align_left">страница показывающая микросообщение с id <code>1</code></td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left">/microposts/new</td><td class="align_left"><code>new</code></td><td class="align_left">страница для создания нового микросообщения</td></tr><tr><td class="align_left"><tt>POST</tt></td><td class="align_left">/microposts</td><td class="align_left"><code>create</code></td><td class="align_left">создание нового микросообщения</td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left">/microposts/1/edit</td><td class="align_left"><code>edit</code></td><td class="align_left">страница для редактирования микросообщения с id <code>1</code></td></tr><tr><td class="align_left"><tt>PUT</tt></td><td class="align_left">/microposts/1</td><td class="align_left"><code>update</code></td><td class="align_left">обновление микросообщения с id <code>1</code></td></tr><tr><td class="align_left"><tt>DELETE</tt></td><td class="align_left">/microposts/1</td><td class="align_left"><code>destroy</code></td><td class="align_left">удаление микросообщения с id <code>1</code></td></tr></table></div><div class="caption"><span class="header">Таблица 2.3: </span><span class="description">RESTful маршруты, обеспеченные ресурсом Microposts в <a class="ref" href="a-demo-app#code-demo_microposts_resource">Листинге&nbsp;2.7</a>.</span></div></div>


<p>Сам Microposts контроллер в схематичной форме представлен в <a class="ref" href="a-demo-app#code-demo_microposts_controller">Листинге&nbsp;2.8</a>. Отметьте, что, кроме наличия <code>MicropostsController</code> вместо <code>UsersController</code>, <a class="ref" href="a-demo-app#code-demo_microposts_controller">Листинг&nbsp;2.8</a> <em>идентичен</em> коду в <a class="ref" href="a-demo-app#code-demo_users_controller">Листинге&nbsp;2.3</a>. Это отражение REST архитектуры, характерной для обоих ресурсов.</p>

<div class="label" id="code-demo_microposts_controller"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.8.</span> <span class="description">Контроллер Microposts в схематичной форме. <br /> <code>app/controllers/microposts_controller.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MicropostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">edit</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>для того чтобы сделать несколько настоящих микросообщений, мы вводим информацию на new странице микросообщений, <a href="http://localhost:3000/microposts/new">/microposts/new</a> как видно на <a class="ref" href="a-demo-app#fig-demo_new_micropost_rails_3">Рис.&nbsp;2.12</a>.</p>

<div class="label" id="fig-demo_new_micropost_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_new_micropost_rails_3.png" alt="demo_new_micropost_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.12: </span><span class="description">Страница для создания микросообщений (<a href="http://localhost:3000/microposts/new">/microposts/new</a>).&nbsp;<a href="http://railstutorial.org/images/figures/demo_new_micropost-full.png">(полный размер)</a></span></div></div>


<p>Теперь создайте одно - два микросообщения,  удостоверьтесь, чтобы по крайней мере у одного из них был <code>user_id</code>&nbsp;=&nbsp;<code>1</code> для сопоставления с id первого пользователя, созданного в <a class="ref" href="a-demo-app#sec-a_user_tour">Разделе&nbsp;2.2.1</a>. Результат должен быть похож на <a class="ref" href="a-demo-app#fig-demo_micropost_index_rails_3">Рис.&nbsp;2.13</a>.</p>

<div class="label" id="fig-demo_micropost_index_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_micropost_index_rails_3.png" alt="demo_micropost_index_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.13: </span><span class="description">Страница списка микросообщений (<a href="http://localhost:3000/microposts">/microposts</a>).&nbsp;<a href="http://railstutorial.org/images/figures/demo_micropost_index_rails_3-full.png">(полный размер)</a></span></div></div>




<div class="label" id="sec-putting_the_micro_in_microposts"></div>


<h3><a id="sec-2_3_2" href="a-demo-app#sec-putting_the_micro_in_microposts" class="heading"><span class="number">2.3.2</span> Помещение <em>микро</em> в микросообщения</a></h3>


<p>Каждое <em>микро</em>сообщение, достойное своего имени, должно иметь некоторые средства предписания длины сообщения. Реализация этого ограничения в Rails легка с <em>проверками допустимости</em> (валидациями); чтобы принять микросообщения с, самое большее, 140 символами (а-ля Twitter), мы используем проверку допустимости (валидацию) <em>длины</em>. В этой точке следует открыть файл <code>app/models/micropost.rb</code> в вашем текстовом редакторе или IDE и заполнить его содержимым <a class="ref" href="a-demo-app#code-demo_length_validation">Листинга&nbsp;2.9</a>. (Использование <em>валидации</em> из <a class="ref" href="a-demo-app#code-demo_length_validation">Листинга&nbsp;2.9</a> характерно для Rails&nbsp;3; если вы ранее работали с Rails&nbsp;2.3, следует сравнить это с использованием <code>validates_length_of</code>.)</p>

<div class="label" id="code-demo_length_validation"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.9.</span> <span class="description">Ограничение микросообщений максимумом в 140 знаков посредством валидации длины. <br /> <code>app/models/micropost.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Micropost</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord::Base</span>
  <span class="n">attr_accessible</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">:user_id</span>
  <span class="n">validates</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">:length</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:maximum</span> <span class="o">=&gt;</span> <span class="mi">140</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Код в <a class="ref" href="a-demo-app#code-demo_length_validation">Листинге&nbsp;2.9</a> может выглядеть, довольно таинственно &mdash; мы рассмотрим валидацию более тщательно  в <a class="ref" href="modeling-users#sec-user_validations">Разделе&nbsp;6.2</a> &mdash; но его эффект станет вполне очевиден, если мы перейдем в новую страницу микросообщений и введем больше чем 140 символов для контента сообщения. Как видно на <a class="ref" href="a-demo-app#fig-micropost_length_error_rails_3">Рис.&nbsp;2.14</a>, , Rails выдает <em>сообщение об ошибке</em> указывающее на то, что контент микросообщения является слишком длинным. (Мы узнаем больше о сообщениях об ошибках в  <a class="ref" href="sign-up#sec-signup_error_messages">Разделе&nbsp;7.3.2</a>.)</p>

<div class="label" id="fig-micropost_length_error_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/micropost_length_error_rails_3.png" alt="micropost_length_error_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.14: </span><span class="description">Сообщение об ошибке для неудачно созданного микросообщения.&nbsp;<a href="http://railstutorial.org/images/figures/micropost_length_error_rails_3-full.png">(полный размер)</a></span></div></div>




<div class="label" id="sec-demo_user_has_many_microposts"></div>


<h3><a id="sec-2_3_3" href="a-demo-app#sec-demo_user_has_many_microposts" class="heading"><span class="number">2.3.3</span> A user <code>has_many</code> microposts (Пользователь <code>имеет_много</code> микросообщений)</a></h3>


<p>Одна из наиболее мощных функций Rails &#8211; возможность формировать <em>связи</em> между различными моделями данных. В случае нашей модели User  у каждого пользователя потенциально есть много микросообщений. Мы можем выразить это в коде, обновив модели User и Micropost как это показано в <a class="ref" href="a-demo-app#code-demo_user_has_many_microposts">Листинге&nbsp;2.10</a> и <a class="ref" href="a-demo-app#code-demo_micropost_belongs_to_user">Листинге&nbsp;2.11</a>.</p>

<div class="label" id="code-demo_user_has_many_microposts"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.10.</span> <span class="description">У пользователя есть много микросообщений (user has many microposts). <br /> <code>app/models/user.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord::Base</span>
  <span class="n">attr_accessible</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:name</span>
  <span class="n">has_many</span> <span class="ss">:microposts</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code-demo_micropost_belongs_to_user"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.11.</span> <span class="description">Микросообщения принадлежат пользователю (micropost belongs to a user). <br /> <code>app/models/micropost.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Micropost</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord::Base</span>
  <span class="n">attr_accessible</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">:user_id</span>

  <span class="n">belongs_to</span> <span class="ss">:user</span>

  <span class="n">validates</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">:length</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:maximum</span> <span class="o">=&gt;</span> <span class="mi">140</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Мы можем увидеть результат применения этой ассоциации на <a class="ref" href="a-demo-app#fig-micropost_user_association">Рис.&nbsp;2.15</a>. Из-за <code>user_id</code> столбца в таблице <code>microposts</code> Rails (используя Active Record) может вывести микросообщения, связанные с каждым пользователем.</p>

<div class="label" id="fig-micropost_user_association"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/micropost_user_association.png" alt="micropost_user_association" /></span></div><div class="caption"><span class="header">Рис. 2.15: </span><span class="description">Связь между микросообщениями и пользователями.</span></div></div>


<p>В <a class="ref" href="user-microposts#top">Главе&nbsp;10</a> и <a class="ref" href="following-users#top">Главе&nbsp;11</a>, мы будем использовать ассоциацию пользователей и микросообщений и чтобы вывести на экран все микросообщения пользователя, и чтобы создать Twitter-подобную подачу микросообщений. Пока, мы можем исследовать применение связи микросообщения-пользователь с помощью <em>консоли</em>, которая является полезным инструментом для взаимодействия с Rails приложениями. Сначала мы вызовем консоль командой <code>rails console</code> в командной строке, а затем получим первого пользователя из базы данных, используя <code>User.first</code> (поместив результаты в переменную <code>first_user</code>):<sup class="footnote" id="fnref-2_7"><a href="#fn-2_7">7</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="go">$ rails console</span>
<span class="gp">&gt;&gt; </span><span class="n">first_user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">first</span>
<span class="go">=&gt; #&lt;User id: 1, name: &quot;Michael Hartl&quot;, email: &quot;michael@example.org&quot;,</span>
<span class="go">created_at: &quot;2011-11-03 02:01:31&quot;, updated_at: &quot;2011-11-03 02:01:31&quot;&gt;</span>
<span class="gp">&gt;&gt; </span><span class="n">first_user</span><span class="o">.</span><span class="n">microposts</span>
<span class="go">=&gt; [#&lt;Micropost id: 1, content: &quot;First micropost!&quot;, user_id: 1, created_at:</span>
<span class="go">&quot;2011-11-03 02:37:37&quot;, updated_at: &quot;2011-11-03 02:37:37&quot;&gt;, #&lt;Micropost id: 2,</span>
<span class="go">content: &quot;Second micropost&quot;, user_id: 1, created_at: &quot;2011-11-03 02:38:54&quot;,</span>
<span class="go">updated_at: &quot;2011-11-03 02:38:54&quot;&gt;]</span>
<span class="gp">&gt;&gt; </span><span class="nb">exit</span>
</pre></div>
</div>


<p>(Я включил последнюю строку только чтобы продемонстрировать, как выйти из консоли, и на большинстве систем вы можете использовать Ctrl-d с этой же целью.) Здесь мы получили доступ к микросообщениям пользователя, используя код <code>first_user.microposts</code>: с этим кодом Active Record автоматически возвращает все микросообщения с <code>user_id</code> равным id <code>first_user</code> (в данном случае,&nbsp;<code>1</code>). Мы узнаем намного больше о возможностях ассоциаций (связей) Active Record в <a class="ref" href="user-microposts#top">Главе&nbsp;10</a> и <a class="ref" href="following-users#top">Главе&nbsp;11</a>.</p>

<div class="label" id="sec-inheritance_hierarchies"></div>


<h3><a id="sec-2_3_4" href="a-demo-app#sec-inheritance_hierarchies" class="heading"><span class="number">2.3.4</span> Иерархия наследования</a></h3>


<p>Мы закончим наше обсуждение демонстрационного приложения кратким описанием иерархии классов контроллеров и моделей в Rails. Это обсуждение будет иметь много смысла, только если у вас был некоторый опыт объектно-ориентированного программирования (ООП); если вы не изучали ООП, не стесняйтесь пропустить этот раздел. В частности, если вы не знакомы с <em>классами</em> (обсуждаемыми в <a class="ref" href="rails-flavored-ruby#sec-ruby_classes">Разделе&nbsp;4.4</a>), я предлагаю вернуться к этому разделу позже.</p>

<p>Мы начнем со структуры наследования для моделей. Сравнивая <a class="ref" href="a-demo-app#code-demo_user_class">Листинг&nbsp;2.12</a> с <a class="ref" href="a-demo-app#code-demo_micropost_class">Листингом&nbsp;2.13</a>, , мы видим, что и модель User и модель Micropost наследовались (через левую угловую скобку&nbsp;<code>&lt;</code>) от <code>ActiveRecord::Base</code>, который является базовым классом для моделей, предоставляемых библиотекой ActiveRecord; схема, резюмирующая это отношение, представлена на <a class="ref" href="a-demo-app#fig-demo_model_inheritance">Рис.&nbsp;2.16</a>. Благодаря наследованию от <code>ActiveRecord::Base</code> наши объекты модели получают возможность связываться с базой данных, обрабатывать столбцы базы данных как Ruby атрибуты и так далее.</p>

<div class="label" id="code-demo_user_class"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.12.</span> <span class="description">Класс <code>User</code>, с наследованием. <br /> <code>app/models/user.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord::Base</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code-demo_micropost_class"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.13.</span> <span class="description">Класс <code>Micropost</code> с наследованием. <br /> <code>app/models/micropost.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Micropost</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord::Base</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="fig-demo_model_inheritance"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_model_inheritance.png" alt="demo_model_inheritance" /></span></div><div class="caption"><span class="header">Рис. 2.16: </span><span class="description">Иерархия наследования для моделей User и Micropost.</span></div></div>


<p>Структура наследования для контроллеров лишь немногим более сложная. Сравнивая <a class="ref" href="a-demo-app#code-demo_users_controller_class">Листинг&nbsp;2.14</a> с <a class="ref" href="a-demo-app#code-demo_microposts_controller_class">Листингом&nbsp;2.15</a>, мы видим, что и контроллер User и контроллер Micropost наследовались от Application controller. Исследуя <a class="ref" href="a-demo-app#code-demo_application_controller_class">Листинг&nbsp;2.16</a>, мы видим, что сам <code>ApplicationController</code> наследует от <code>ActionController::Base</code>;  это базовый класс для контроллеров, обеспеченных  Rails библиотекой Action Pack. Отношения между этими классами иллюстрируются в <a class="ref" href="a-demo-app#fig-demo_controller_inheritance">Рис.&nbsp;2.17</a>.</p>

<div class="label" id="code-demo_users_controller_class"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.14.</span> <span class="description">Класс <code>UsersController</code>, с наследованием. <br /> <code>app/controllers/users_controller.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code-demo_microposts_controller_class"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.15.</span> <span class="description">Класс <code>MicropostsController</code>, с наследованием. <br /> <code>app/controllers/microposts_controller.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MicropostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code-demo_application_controller_class"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.16.</span> <span class="description">Класс <code>ApplicationController</code>, с наследованием. <br /> <code>app/controllers/application_controller.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="ss">ActionController::Base</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="fig-demo_controller_inheritance"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_controller_inheritance.png" alt="demo_controller_inheritance" /></span></div><div class="caption"><span class="header">Рис. 2.17: </span><span class="description">Иерархия наследования для контроллеров Users и Microposts.</span></div></div>


<p>Как и с наследованием моделей, будучи, в конечном счете, наследниками  <code>ActionController::Base</code> и Users и Microposts контроллеры имеют большое количество функций, таких как возможность управлять объектами модели, фильтровать входящие запросы HTTP, и визуализировать представления как HTML. Так как все контроллеры Rails наследовались от <code>ApplicationController</code>, правила, определенные в ApplicationController автоматически, применяются к каждому действию в приложении. Например, в <a class="ref" href="sign-in-sign-out#sec-remember_me">Разделе&nbsp;8.2.1</a> мы увидим как включить хелперы для входа и выхода во все контроллеры примера приложения.</p>

<div class="label" id="sec-deploying_the_demo_app"></div>


<h3><a id="sec-2_3_5" href="a-demo-app#sec-deploying_the_demo_app" class="heading"><span class="number">2.3.5</span> Развертывание демонстационного приложения</a></h3>


<p>Закончив ресурс Microposts, мы можем отправить репозиторий на GitHub:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git add .
<span class="gp">$</span> git commit -a -m <span class="s2">&quot;Finish demo app&quot;</span>
<span class="gp">$</span> git push
</pre></div>
</div>


<p>Обычно вам следует делать более частые коммиты, но для этой главы единственный большой коммит в конце - это вполне нормально.</p>

<p>Можно также развернуть demo app на Heroku как и в <a class="ref" href="beginning#sec-deploying">Разделе&nbsp;1.4</a>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> heroku create --stack cedar
<span class="gp">$</span> git push heroku master
</pre></div>
</div>


<p>Наконец, запустите миграции для продакшен базы данных (см. ниже если вы получили deprecation warning):</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> heroku run rake db:migrate
</pre></div>
</div>


<p>Это обновит базу данных на Heroku с необходимой моделью данных. Вы можете получить "deprecation warning" относящееся к assets в <code>vendor/plugins</code>, которое вам следует игнорировать, поскольку в этой директории нет никаких плагинов.</p>

<h2><a id="sec-2_4" href="a-demo-app#sec-2_4" class="heading"><span class="number">2.4</span> Заключение</a></h2>


<p>Мы подошли к концу 9 144 метрового (30,000-foot ) обзора Rails приложения. У demo app, разработанного в этой главе, есть несколько достоинств и масса недостатков. <br /></p>

<p><strong>Достоинства</strong></p>

<ul>
  <li>Общее представление о Rails</li>
  <li>Введение в MVC</li>
  <li>Первый вкус архитектуры REST</li>
  <li>Начальное моделирование данных</li>
  <li>Живое, поддерживаемое базой данных веб-приложение в production</li>
</ul>


<p><strong>Недостатки</strong></p>

<ul>
  <li>Нет собственного макета или стиля</li>
  <li>Нет статических страниц (таких как "Главная" или "О нас")</li>
  <li>Нет паролей пользователя</li>
  <li>Нет изображений пользователя</li>
  <li>Нет регистрации</li>
  <li>Нет безопасности</li>
  <li>Нет автоматической связи пользователь/микросообщение</li>
  <li>Нет понятий &ldquo;following&rdquo; или &ldquo;followed&rdquo;</li>
  <li>Нет потока (ленты) микросообщений</li>
  <li>Нет разработки через тестирование</li>
  <li><strong>Нет реального понимания</strong></li>
</ul>


<p>Остальная часть этого учебника посвящена усилению достоинств и устранению недостатков.</p>

<div class="navigation">  <a class="prev_page" href="beginning#top">
    &laquo;&nbsp;<span class="number">Глава 1</span> От нуля к развертыванию
  </a>
  <a class="next_page" href="static-pages#top">
    <span class="number">Глава 3</span> В основном статические страницы&nbsp;&raquo;
  </a>
</div><div class="footnotes">
<ol>
<li id="fn-2_1">Моделируя более длинные сообщения,  для нормального (не микро) блога, следует использовать тип <code>text</code> вместо <code>string</code>.&nbsp;<a class="arrow" href="#fnref-2_1">&uarr;</a></li>
<li id="fn-2_2">Имя scaffold следует за соглашением в соответствии с которым, <em>модели</em> имеют единственное число, в отличие от ресурсов и контроллеров, которые используются во множественном числе. Таким образом, у нас есть <em>User</em> вместо <em>Users</em>.&nbsp;<a class="arrow" href="#fnref-2_2">&uarr;</a></li>
<li id="fn-2_3">Некоторые источники утверждают, что представление возвращает HTML непосредственно браузеру (через веб-сервер, такой как Apache или Nginx). Независимо от деталей реализации, я предпочитаю думать о контроллере как о центральном хабе через который проходят информационные потоки всего приложения.&nbsp;<a class="arrow" href="#fnref-2_3">&uarr;</a></li>
<li id="fn-2_4">Fielding, Roy Thomas. <em>Architectural Styles and the Design of Network-based Software Architectures</em>. Doctoral dissertation, University of California, Irvine, 2000.&nbsp;<a class="arrow" href="#fnref-2_4">&uarr;</a></li>
<li id="fn-2_5">Как и с User scaffold, генератор scaffold для микросообщений следует сингулярному соглашению для моделей Rails; таким образом, мы имеем, <code>generate Micropost</code>, а не <code>generate MicropostS</code>.&nbsp;<a class="arrow" href="#fnref-2_5">&uarr;</a></li>
<li id="fn-2_6">У кода scaffold могут быть дополнительные новые строки по сравнению с <a class="ref" href="a-demo-app#code-demo_microposts_resource">Листингом&nbsp;2.7</a>. Это не повод для беспокойства, поскольку Ruby игнорирует дополнительные новые строки.&nbsp;<a class="arrow" href="#fnref-2_6">&uarr;</a></li>
<li id="fn-2_7">Ваше приглашение командной строки, вероятно, будет чем-то вроде <code>ruby-1.9.3-head &gt;</code>, но я буду использовать&nbsp;<tt class="verb">&gt;&gt;</tt> поскольку версии Ruby могут отличаться.&nbsp;<a class="arrow" href="#fnref-2_7">&uarr;</a></li>
</ol>
</div>
